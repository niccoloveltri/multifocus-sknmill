\documentclass[runningheads]{llncs}
\providecommand{\event}{NCL'22} % Name of the event you are submitting to
%\usepackage{breakurl}             % Not needed if you use pdflatex only.
\usepackage{underscore}           % Only needed if you use pdflatex.
\usepackage{amsmath}
%\usepackage{amsthm}
%\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{mathtools}
\usepackage{enumerate}
\usepackage{prftree}
%\usepackage{ntheorem}
%\usepackage{tikz-cd}
\usepackage{hyperref}
%\usepackage{float}
%\usepackage{graphicx}
%\usepackage{quiver}
\usepackage[all,cmtip]{xy}
\usepackage{proof}
\usepackage{pdflscape}
\usepackage{dashbox}
%\usepackage[a4paper, total={6in, 8in}]{geometry}
%\usepackage{lscape}
%% \theorembodyfont{}
%\newtheorem{theorem}{Theorem}[section]
%\newtheorem{corollary}[theorem]{Corollary}
%\newtheorem{lemma}[theorem]{Lemma}
%\newtheorem{remark}[theorem]{Remark}
%\newtheorem{proposition}[theorem]{Proposition}
%\theoremstyle{definition}
%\newtheorem{defn}{Definition}[section]
%\newtheorem{example}{Example}[section]
%\newtheorem{defn}[definition]{Definition}
%\newtheorem{example}[definition]{Definition}
%\newtheorem*{proof}{Proof : }
\usepackage{cleveref}
\usepackage{bbm}
%\newtheorem{fact}[theorem]{Fact}
\usepackage{cancel}
\makeatletter
\newsavebox{\@brx}
\newcommand{\llangle}[1][]{\savebox{\@brx}{\(\m@th{#1\langle}\)}%
  \mathopen{\copy\@brx\kern-0.5\wd\@brx\usebox{\@brx}}}
\newcommand{\rrangle}[1][]{\savebox{\@brx}{\(\m@th{#1\rangle}\)}%
  \mathclose{\copy\@brx\kern-0.5\wd\@brx\usebox{\@brx}}}
\makeatother
\newcommand\dboxed[1]{\dbox{\ensuremath{#1}}}
\newcommand{\ldbc}{[\![}
    \newcommand{\rdbc}{]\!]}
\renewcommand{\vec}{\overrightarrow}
\newcommand{\tbar}{[\vec{x}/\vec{t}]}
\newcommand{\ltbar}{[\vec{x}, x/\vec{t}, x]}
\newcommand{\tl}{\otimes \mathsf{L}}
\newcommand{\tr}{\otimes \mathsf{R}}
\newcommand{\lright}{{\multimap}\mathsf{R}}
\newcommand{\lleft}{{\multimap}\mathsf{L}}
\newcommand{\pass}{\mathsf{pass}}
\newcommand{\M}{\mathsf{M}}
\newcommand{\unitl}{\mathsf{IL}}
\newcommand{\unitr}{\mathsf{IR}}
\newcommand{\otL}{\tl}
\newcommand{\otR}{\tr}
\newcommand{\lolliR}{\lright}
\newcommand{\lolliL}{\lleft}
\newcommand{\IL}{\unitl}
\newcommand{\IR}{\unitr}
\newcommand{\ax}{\mathsf{ax}}
\newcommand{\id}{\mathsf{id}}
\newcommand{\ot}{\otimes}
\newcommand{\lolli}{\multimap}
\newcommand{\illol}{\rotatebox[origin=c]{180}{$\multimap$}}
\newcommand{\I}{\mathsf{I}}
\newcommand{\msfL}{\mathsf{L}}
\newcommand{\defeq}{=_{\mathsf{df}}}
\newcommand{\comp}{\mathsf{comp}}
\newcommand{\RI}{\mathsf{RI}}
\newcommand{\LI}{\mathsf{LI}}
\newcommand{\Pass}{\mathsf{P}}
\newcommand{\F}{\mathsf{F}}
\newcommand{\xvdash}{\vdash^{x}}
\newcommand{\yvdash}{\vdash^{y}}
\renewcommand{\L}{\mathsf{L}}
\newcommand{\otd}{\ot^D}
\newcommand{\lollid}{\;\textsuperscript{$D$}\!\!\lolli}
\newcommand{\lfm}{\dn_\mathsf{lfm}}%{\Rrightarrow_\mathsf{lfm}}
\newcommand{\rfm}{\dn_\mathsf{rfm}}%{\Rrightarrow_\mathsf{rfm}}
\newcommand{\lf}{\dn_\mathsf{lf}}%{\Rrightarrow_\mathsf{lf}}
\newcommand{\rf}{\dn_\mathsf{rf}}%{\Rrightarrow_\mathsf{rf}}
\newcommand{\highlight}[1]{\textcolor{blue}{#1}}

\newcommand{\proofbox}[1]{\begin{tabular}{l} #1 \end{tabular}}

\newcommand{\MALL}{\texttt{MALL}}
\newcommand{\MILL}{\texttt{MILL}}
\newcommand{\NMILL}{\texttt{NMILL}}
\newcommand{\SkNMILL}{\texttt{SkNMILL}}
\newcommand{\FSkMCC}{\mathsf{Free}}

%%\newcommand{\tarmo}[1]{}
%%\newcommand{\niccolo}[1]{}
%%\newcommand{\cheng}[1]{}

\newcommand{\cheng}[1]{{\color{blue}\textbf{Cheng: }#1}}
\newcommand{\niccolo}[1]{{\color{red}\textbf{Niccol{\`o}: }#1}}
\newcommand{\tarmo}[1]{{\color{ForestGreen}\textbf{Tarmo: }#1}}

\usepackage[dvipsnames]{xcolor}

\newcommand{\red}[1]{{\color{Red}#1}}
\newcommand{\blue}[1]{{\color{Cerulean}#1}}
\newcommand{\green}[1]{{\color{Green}#1}}

\newcommand{\UT}{\mathsf{UT}}

\newcommand\rfbox{\fcolorbox{red}{white}}

\newcommand{\up}{\Uparrow}
\newcommand{\dn}{\Downarrow}
\newcommand{\upm}{\Uparrow_{\mathsf{m}}}
\newcommand{\dnm}{\Downarrow_{\mathsf{m}}}
\newcommand{\sw}{\mathsf{sw}}
\newcommand{\focL}{\mathsf{foc_L}}
\newcommand{\foc}{\mathsf{foc}}
\newcommand{\focR}{\mathsf{foc_R}}
\newcommand{\blurL}{\mathsf{blur_L}}
\newcommand{\blurR}{\mathsf{blur_R}}
\newcommand{\focLR}{\mathsf{foc_{M}}}
\newcommand{\blurLR}{\mathsf{blur_{M}}}
\newcommand{\focM}{\focLR}
\newcommand{\blurM}{\blurLR}
\renewcommand{\t}{\mathbbm{t}}
\renewcommand{\r}{\mathbbm{r}}
\renewcommand{\l}{\mathbbm{l}}
\newcommand{\tagL}{\mathsf{tag_L}}
\newcommand{\tagR}{\mathsf{tag_R}}
\newcommand{\tagM}{\mathsf{notag}}
\newcommand{\unfoc}{\mathsf{unfoc}}
%\newcommand{\blurR}{\mathsf{tag_R}}
%\newcommand{\blurM}{\mathsf{notag}}

\newcommand{\focus}{\mathsf{focus}}
\newcommand{\emb}{\mathsf{emb}}

\newcommand{\At}{\mathsf{At}}
\newcommand{\runL}{\mathsf{runL}}
\newcommand{\Prf}{\mathsf{Prf}}

%% Commands for changing vertical space before and after caption in a figure
%\setlength{\abovecaptionskip}{0pt}
%\setlength{\belowcaptionskip}{-15pt}

\begin{document}

\title{Maximally Multi-Focused Proofs for Skew Non-Commutative \MILL\thanks{We thank Alexis Saurin and Noam Zeilberger for valuable discussions. This work was supported by the Estonian Research Council grant PSG749, the ESF funded Estonian IT Academy research measure (project 2014-2020.4.05.19-0001) and COST CA19135 - Connecting Education and Research Communities for an Innovative Resource Aware Society.}}

\author{Niccol{\`o} Veltri\inst{1}\orcidID{0000-0002-7230-3436}}
%
\authorrunning{N. Veltri}
%\def\titlerunning{} %Proof Theory of Skew Non-Commutative \MILL}
%\def\authorrunning{} %T. Uustalu, N. Veltri \& C.-S. Wan}
%\begin{document}
\institute{Tallinn University of Technology, Tallinn, Estonia \\
\email{niccolo@cs.ioc.ee}}
%
\maketitle
%
\begin{abstract}

  Multi-focusing is a generalization of Andreoli's focusing procedure which allows the parallel application of synchronous rules to multiple formulae under focus. By restricting to the class of maximally multi-focused proofs, one recovers permutative canonicity directly in the sequent calculus without the need to switch to other formalisms, e.g. proof nets, in order to  represent proofs modulo permutative conversions. This characterization of canonical proofs is also amenable for the mechanization of the normalization procedure and the performance of further formal proof-theoretic investigations in interactive theorem provers.

  In this work we present a sequent calculus of maximally multi-focused proofs for skew non-commutative multiplicative linear logic (\SkNMILL), a logic recently introduced by Uustalu, Veltri and Wan which enjoys categorical semantics in the skew monoidal closed categories of Street. The peculiarity of the multi-focused system for \SkNMILL\ is the presence of at most two foci in synchronous phase. This reduced complexity makes it a good starting point for the formal investigations of maximally multi-focused calculi for richer substructural logics.
  %ed calculi in a proof assistant. We present the normalization procedure and compare the resulting canonical proofs with a different class of normal forms described by Uustalu et al.
  
  \keywords{skew non-commutative MILL \and maximal multi-focusing \and skew monoidal closed categories \and substructural logic \and Agda}  
\end{abstract}

\section{Introduction}\label{sec:intro}

\emph{Focusing} is a technique introduced by Andreoli for reducing permutative non-determinism in proof search. It was originally applied to the cut-free sequent calculus of classical first-order linear logic \cite{andreoli:logic:1992} and subsequently ported to many other proof systems \cite{LiangM09}. Andreoli's key idea was the organization of root-first proof search in the alternation of two distinct phases: the asynchronous phase, where invertible rules are eagerly applied, and the synchronous phase, where non-invertible rules are applied on a selected formula which is brought under focus.
%Andreoli showed that his proof search strategy is sound and complete.

Focusing still retains a large amount of non-determinism in proof search, since many different formulae can possibly be brought under focus. Specifically, the non-determinism introduced by inessential permutative conversions is not resolved. Typically, a linear logician would solve this issue by leaving the sequent calculus and moving to a graphical representation of proofs, such as Girard's proof nets \cite{Girard87}. Chaudhuri et al.~\cite{chaudhuri:canonical:2008} showed that it is not necessary to depart from the sequent calculus formalism to represent canonical derivations wrt. the equational theory generated by the permutative conversions. They introduce a \emph{multi-focused sequent calculus} where multiple formulae can simultaneously be brought under focus and decomposed during the synchronous phase. They then present a rewriting system on multi-focused proofs whose normal forms are \emph{maximally multi-focused}. These are derivations $f$ which, at the beginning of each synchronous phase, always pick the largest number of formulae to bring under focus among the multi-focused derivations which are equivalent to $f$ wrt. the equational theory of permutative conversions. In this sense, maximally multi-focused proofs exhibit the maximal amount of parallelism. Chaudhuri et al. showed that these are equivalent to proof nets for unit-free multiplicative classical linear logic. Multi-focusing and maximality have subsequently been applied to other deductive systems \cite{ChaudhuriHM16,Brock-Nannestad18}, in particular variants of intuitionistic logic \cite{Scherer15,PimentelNN16}.

This work serves as a starting point for a comprehensive study of maximal multi-focused deductive systems for a large class of substructural logics. It is well-known that many substructural logics enjoy normalization procedures targeting variants of proof nets, e.g. the Lambek calculus \cite{LR:pronlc}. Nevertheless, an extensive study of maximally multi-focused proofs for these logics is missing. We believe this to be especially beneficial for the development of proof-theoretic investigations of logical systems in interactive theorem provers, such as Coq or Agda, where  the graphical syntax of proof nets would be harder to implement than sequent calculi, whose inference rules are standard example of inductive type families.

We initiate this endeavor by considering \emph{skew non-commutative multiplicative linear logic} (\SkNMILL), a weak substructural logic recently introduced by the author in collaboration with Uustalu and Wan~\cite{UVW:protsn}. This logic is a \emph{semi-associative} and \emph{semi-unital} variant of Lambek calculus (with only one residual): it validates structural rules of associativity $(A \ot B) \ot C \to A \ot (B \ot C)$ and unitality $\I \ot A \to A$ and $A \to A \ot \I$, but none of their inverses. Uustalu et al. introduce a cut-free sequent calculus for \SkNMILL\ whose sequents are triples of the form $S \mid \Gamma \vdash A$, where $S$ is an optional formula (called stoup), $\Gamma$ is an ordered list of formulae and $A$ is a single formula. A peculiarity of this calculus is that left logical rules act exclusively on the formula in the stoup position, never on formulae in context $\Gamma$. This makes this sequent calculus a good candidate for initiating the formal study of maximal multi-focusing of substructural logics: during the synchronous phase, at most \emph{two} formulae can be brought under focus, the stoup formula and the succedent formula. From this perspective, the sequent calculus of \SkNMILL\ is among the ``simplest'' deductive system which enjoys non-trivial multi-focusing.

The study of \SkNMILL\ was initially motivated by its categorical semantics in the \emph{skew monoidal closed categories} of Street \cite{street:skew-closed:2013}. These categories arise naturally in semantics of programming languages \cite{altenkirch:monads:2014}, while semi-associativity has found strong connections with combinatorial structures such as the Tamari lattice and Stasheff associahedra \cite{zeilberger:semiassociative:19,moortgat:tamari:20}. From a category-theoretic perspective, the maximal multi-focusing procedure described in this paper provides a solution to the \emph{coherence} problem for skew monoidal closed categories.

The paper starts with a brief introduction of \SkNMILL\ and its cut-free sequent calculus. It continues with a presentation of a sound and complete multi-focused sequent calculus. As expected, the latter does not resolve all the permutative non-determinism, but its introduction is pedagogically useful as it sets the stage for the more involved maximally multi-focused sequent calculus. The latter uses a system of \emph{tags}, or colors, similarly employed by Uustalu et al. in their calculus of normal forms \cite{UVW:protsn}, which are inspired by Scherer and R{\'e}my's saturation technique \cite{scherer:simple:2015}.
Tags are used to keep track of new formulae appearing in context from the application of invertible rules and to decide whether multi-focusing on both the stoup and succedent formulae is admissible or not.

An important contribution of this project is the formalization of the maximal multi-focusing calculus for \SkNMILL\ and the proof of its correctness in the Agda proof assistant. The code, containing all the material presented in the paper, can be found at: \url{https://github.com/niccoloveltri/multifocus-sknmill}. 
%the definition of the normalization functions of \Cref{thm,thm2}. \Cref{thm3} has only been checked on pen and paper, its formalization is work in progress and will be discussed in an extended version of this paper.


\section{The Sequent Calculus of \SkNMILL}\label{sec:seqcalc}

We recall the definition of the sequent calculus for \SkNMILL\ originally introduced in \cite{UVW:protsn}.
Formulae are generated by the grammar $A,B ::= X \ | \ \I \ | \ A \ot B \ | \ A \lolli B$, where $X$ comes from a fixed set $\At$ of atomic formulae, $\I$ is a multiplicative unit, $\ot$ is a multiplicative tensor and $\lolli$ is a linear implication. Formulae $\I$ and $A \ot B$ are \emph{positive} while $A \lolli B$ is \emph{negative}. 

A sequent is a triple of the form $S \mid \Gamma \vdash A$, where the succedent $A$ is a single formula (as in non-commutative multiplicative linear logic \NMILL) and the antecedent is divided in two parts: an optional formula $S$, called \emph{stoup}, and an ordered list of formulae $\Gamma$, called \emph{context}. 
The metavariable $S$ always denotes a stoup, i.e. $S$ can be a single formula or empty, in which case we write $S = -$.

Derivations of a sequent $S \mid \Gamma \vdash A$ are inductively generated by the rules in \Cref{fig:seqcalc}.
%\begin{defn}
%  \emph{SkNMILL} is a sequent calculus system whose sequents are in the form of $S \mid \Gamma \vdash A$ coustructed with following rules
There are a few important differences with the sequent calculus of \NMILL:
1) left rules can only act on the formula in stoup position, not on formulae in context; 2) the right $\ot$-rule, when read bottom-up, forces the formula in the stoup (whenever it is present) to move to the stoup of the first premise, it cannot move to the antecedent of the second premise; 3) as in \NMILL, there are no structural rules of exchange, weakening and contraction, but there is a new structural rule $\pass$ which moves the leftmost formula in context to the stoup, whenever the latter is empty.

As in \NMILL\, rules $\IL$, $\otL$ and $\lolliR$ are invertible, while the other logical rules are not. The structural rule $\pass$ is also non-invertible.
Two forms of \emph{cut} are admissible, since the cut formula can either be located in the stoup or in the context of the second premise. A general axiom rule (often also called \emph{identity}) is also admissible.
%\begin{proposition}
%The following rules are admissible:
\[
\small
    \infer[\mathsf{scut}]{S \mid \Gamma , \Delta \vdash C}{
      S \mid \Gamma \vdash A
      &
      A \mid \Delta \vdash C
    }
    \qquad
    \infer[\mathsf{ccut}]{S \mid \Delta_0 , \Gamma , \Delta_1 \vdash C}{
      - \mid \Gamma \vdash A
      &
      S \mid \Delta_0 , A , \Delta_1 \vdash C
    }
    \qquad
    \infer[\ax_A]{A \mid \quad \vdash A}{}
\]
%\end{proposition}

A stoup $S$ is called \emph{irreducible} if it is either empty, an atom or a negative formula. This means that the stoup formula cannot be further reduced using left invertible rules $\IL$ and $\otL$ in root-first proof search. Analogously, a succedent formula $A$ is irreducible when it is atomic or positive, so it cannot be reduced by the right invertible rule $\lolliR$.


%%The inference rules in (\ref{fig:seqcalc}) are reminiscent of the ones in the sequent calculus for \NMILL\ \cite{abrusci:noncommutative:1990}, but there are some crucial differences.
%%\begin{enumerate}
%%\item The left logical rules $\unitl$, $\tl$ and $\lleft$, read bottom-up, are only allowed to be applied on the formula in the stoup position. In particular, there is no general way to remove a unit $\I$ nor decompose a tensor $A \ot B$ if these formulae are located in the context and not in the stoup (we will see in (\ref{eq:lleft:gen}) that something can actually be done to deal with implications $A \lolli B$ in the context).
%%\item The right tensor rule $\tr$, read bottom-up, splits the antecedent of the conclusion between the two premises whereby the formula in the stoup, in case such a formula is present, has to be moved to the stoup of the first premise. In particular, the stoup formula of the conclusion cannot be moved to the antecedent of the second premise even if $\Gamma$ is chosen to be empty. 
%%\item The presence of the stoup implies a distinction between antecedents of the form $A \mid \Gamma$ and $- \mid \Gamma$. The structural rule $\pass$ (for `passivation`), read bottom-up, allows the moving of the leftmost formula in the context to the stoup position, whenever the stoup is initially empty.
%%\item The logical connectives of \NMILL\ typically include two ordered implications $\lolli$ and $\illol$, which are two variants of linear implication arising from the removal of the exchange rule from intuitionistic linear logic. In \SkNMILL\ only one of the ordered implications (the left implication $\lolli$) is present. It is currently not clear to us whether the inclusion of the second implication to our logic is a meaningful addition and whether it corresponds to some particular categorical notion.
%%\end{enumerate}
%%The restrictions in 1--4 are essential for precisely capturing all the features of skew monoidal closed categories and nothing more, as we discuss in Section \ref{sec:catsem}.
%%Notice also that, similarly to the case of \NMILL, all structural rules of exchange, contraction, and weakening are absent. We give names to derivations and we write $f : S \mid \Gamma \vdash A$ when $f$ is a particular derivation of the sequent $S \mid \Gamma \vdash A$.
%%
%%Examples of valid derivations in the sequent calculus, corresponding to structural laws $\lambda$, $\rho$ and $\alpha$ of skew monoidal closed categories (see Definition \ref{def:skewcat}), are given below. %which will help us  understanding the connection with skew monoidal closed categories.
%%%If we interpret morphism $A \Rightarrow C$ as a sequent $A \mid \quad \vdash C$, then we can see the natural transformations are derivable in this sequent calculus.
%%%For example, natural transformations $\lambda : \I \ot A \Rightarrow A , \rho : A \Rightarrow A \ot \I$, and $\alpha : (A \ot B) \ot C \Rightarrow A \ot (B \ot C)$ in skew monoidal closed categories are admissible in SkNMILL:
%%\begin{equation}\label{eq:lra}
%%  \begin{array}{c@{\;\quad}cc}
%%  (\lambda) & (\rho) & (\alpha) \\
%%  \infer[\tl]{\I \ot A \mid \quad \vdash A}{
%%    \infer[\unitl]{\I \mid A \vdash A}{
%%      \infer[\pass]{- \mid A \vdash A}{
%%        \infer[\ax]{A \mid \quad \vdash A}{}
%%      }
%%    }
%%  }
%%  &
%%  \infer[\tr]{A \mid \quad \vdash A \ot \I}{
%%    \infer[\ax]{A \mid \quad \vdash A}{}
%%    &
%%    \infer[\unitr]{- \mid \quad \vdash \I}{}
%%  }
%%  &
%%  \infer[\tl]{(A \ot B) \ot C \mid \quad \vdash A \ot (B \ot C)}{
%%    \infer[\tl]{A \ot B \mid C \vdash A \ot (B \ot C)}{
%%      \infer[\tr]{A \mid B , C \vdash A \ot (B \ot C)}{
%%        \infer[\ax]{A \mid \quad \vdash A}{}
%%        &
%%        \infer[\pass]{- \mid B , C \vdash B \ot C}{
%%          \infer[\tr]{B \mid C \vdash B \ot C}{
%%            \infer[\ax]{B \mid \quad \vdash B}{}
%%            &
%%            \infer[\pass]{- \mid C \vdash C}{
%%              \infer[\ax]{C \mid \quad \vdash C}{}
%%            }
%%          }
%%        }
%%      }
%%    }
%%  }
%%  \end{array}
%%\end{equation}
%%Examples of non-derivable sequents include the ``inverses'' of the conclusions in (\ref{eq:lra}), obtained by swapping the stoup formula with the succedent formula.
%%%Another important thing is that SkNMILL could not prove the inverse of any natural transformations above.
%%More precisely, the three sequents $X \mid ~ \vdash \I \ot X$, $X \ot \I \mid ~ \vdash X$ and $X \ot (Y \ot Z) \mid ~ \vdash (X \ot Y) \ot Z$ do not have any derivation. All possible attempts of constructing a valid derivation for each of them end in failure.
%%\begin{displaymath}
%%  \begin{array}{ccc}
%%  (\lambda^{-1}) & (\rho^{-1}) & (\alpha^{-1}) \\[6pt]
%%    \infer[\tr]{X \mid ~\vdash \I \ot X}{
%%      \deduce[??]{X \mid ~ \vdash \I}{
%%      }
%%      &
%%      \deduce[??]{- \mid ~ \vdash X}{
%%      }
%%    }
%%    &
%%    \infer[\tl]{X \ot \I \mid \quad \vdash X}{
%%      \deduce{X \mid \I \vdash X}{??}
%%    }
%%    &
%%    \infer[\tl]{X \ot (Y \ot Z) \mid ~\vdash (X \ot Y) \ot Z}{
%%      \deduce{X \mid Y \ot Z \vdash (X \ot Y) \ot Z}{??}
%%    } \\
%%    (\text{$\tr$ sends $X$ to 1st premise}) &
%%    (\text{$\unitl$ does not act on $\I$ in context}) &
%%    (\text{$\tl$ does not act on $\ot$ in context})
%%  \end{array}
%%\end{displaymath}
%%% We interpret $\rho^{-1}$ into $A \ot \I \mid \quad \vdash A$, then according to bottom-up proof search strategy, we first apply $\tl$ but we get stuck immediately.
%%% Therefore, $\rho^{-1}$ is not derivable in our sequent calculus.
%%% Other cases are similar.
%%% In categorical semantics section we will see more details about relationship between SkNMILL and free skew monoidal closed categories.
%%Analogously, the sequents $\I \lolli A \mid ~ \vdash A$ and $(A \ot B) \lolli C \mid ~ \vdash A \lolli (B \lolli C)$ are derivable, while generally their ``inverses'' are not. Also, a derivation of $A \mid ~ \vdash B$ always yields a derivation of $\I \mid ~ \vdash A \lolli B$, but there are $A$, $B$ such that $\I \mid ~ \vdash A \lolli B$ is derivable while  $A \mid ~ \vdash B$ is not (e.g., $A = X$, $B = \I \ot X$).

We consider an equivalence relation $\circeq$ on sets of derivations. This is the congruence generated by the pairs of derivations in \Cref{fig:circeq}, which are permutative conversions. %These are permutative conversions that, when oriented from left to write, move the application of an invertible rule under the application of a non-invertible rule. The last two equations are permutative conversions swapping the application of non-invertible rules $\otR/\pass$ and $\otR/\lolliL$.
\begin{figure}[t]
  \[
  \def\arraystretch{2.5}
  \begin{array}{c}
    \infer[\ax]{X \mid \quad \vdash X}{}
    \qquad
    \infer[\pass]{- \mid A , \Gamma \vdash C}{A \mid \Gamma \vdash C}
    \\
    \infer[\unitl]{\I \mid \Gamma \vdash C}{- \mid \Gamma \vdash C}
    \qquad
    \infer[\tl]{A \ot B \mid \Gamma \vdash C}{A \mid B , \Gamma \vdash C}
    \qquad
    \infer[\lleft]{A \lolli B \mid \Gamma , \Delta \vdash C}{
      - \mid \Gamma \vdash A
      &
      B \mid \Delta \vdash C
    }
    \\
    \infer[\unitr]{- \mid \quad \vdash \I}{}
    \qquad
    \infer[\tr]{S \mid \Gamma , \Delta \vdash A \ot B}{
      S \mid \Gamma \vdash A
      &
      - \mid \Delta \vdash B
    }
    \qquad
    \infer[\lolliR]{S \mid \Gamma \vdash A \lolli B}{S \mid \Gamma , A \vdash B}
  \end{array}
  \]
\caption{Sequent calculus for \SkNMILL.}
\label{fig:seqcalc}  
\end{figure}
\begin{figure}[t]
\begin{align*}\small
%%   \ax_{\I} &\circeq \unitl \text{ } (\unitr)
%%   \\
%%   \ax_{A \ot B} &\circeq \tl \text{ } (\tr \text{ } (\ax_{A} , \pass \text{ } \ax_{B}))
%%   \\
%%   \ax_{A \lolli B} &\circeq \lolliR \text{ } (\lleft \text{ } (\pass \text{ } \ax_{A}, \ax_{B} ))
%%   \\
  \tr \text{ } (\unitl \text{ } f, g) &\circeq \unitl \text{ } (\tr \text{ } (f , g)) &&(f : - \mid \Gamma \vdash A , g : - \mid \Delta \vdash B)
  \\
  \tr \text{ } (\tl \text{ } f, g) &\circeq \tl \text{ } (\tr \text{ } (f , g)) &&(f : A' \mid B' , \Gamma \vdash A , g : - \mid \Delta \vdash B)
  \\
%%   \tr \text{ } (\pass \text{ } f, g) &\circeq \pass \text{ } (\tr \text{ } (f, g)) &&f : A' \mid \Gamma \vdash A, g : - \mid \Delta \vdash B
%%   \\
%%   \tr \text{ } (\lleft \text{ } (f , g), h) & \circeq \lleft \text{ } (f, \tr \text{ } (g, h)) &&f: - \mid \Gamma \vdash A, g : B \mid \Delta \vdash C, h : - \mid \Lambda \vdash D
%%   \\
  \pass \text{ } (\lolliR \text{ } f) &\circeq \lolliR \text{ } (\pass \text{ } f) &&(f : A' \mid \Gamma , A \vdash B)
  \\
  \unitl \text{ } (\lolliR \text{ } f) &\circeq \lolliR \text{ } (\unitl \text{ } f) &&(f : - \mid \Gamma , A \vdash B)
  \\
  \tl \text{ } (\lolliR \text{ } f) &\circeq \lolliR \text{ } (\tl \text{ } f) &&(f : A \mid B , \Gamma , C \vdash D)
  \\
  \lleft \text{ } (f, \lolliR \text{ } g) &\circeq \lolliR \text{ } (\lleft \text{ } (f, g)) &&(f : - \mid \Gamma \vdash A', g : B' \mid \Delta , A \vdash B)
%\end{align*}
%\caption{Invertible/non-invertible permutative conversion for \SkNMILL.}
%\label{fig:circeq}
%\end{figure}
%\begin{figure}[t]
  %\begin{align*}\small
  \\%[9pt]
  \tr \text{ } (\pass \text{ } f, g) &\circeq \pass \text{ } (\tr \text{ } (f, g)) &&(f : A' \mid \Gamma \vdash A, g : - \mid \Delta \vdash B)
  \\
  \tr \text{ } (\lleft \text{ } (f , g), h) & \circeq \lleft \text{ } (f, \tr \text{ } (g, h)) &&(f: - \mid \Gamma \vdash A, g : B \mid \Delta \vdash C, h : - \mid \Lambda \vdash D)
\end{align*}
\caption{Equivalence of derivations in \SkNMILL.}
\label{fig:circeq}
\end{figure}
The congruence $\circeq$ has been chosen to serve as the proof-theoretic counterpart of the equational theory of skew monoidal closed categories \cite{street:skew-closed:2013}.
In fact, there exists a \emph{syntactic} skew monoidal closed category $\FSkMCC(\At)$, which has formulae of $\SkNMILL$ as objects, and morphisms between formulae $A$ and $B$ are given by the set of derivations of $A \mid ~ \vdash B$ quotiented by the equivalence relation $\circeq$. The category $\FSkMCC(\At)$ is the \emph{free} skew monoidal closed category generated by the set $\At$. We refer to \cite{UVW:protsn} for more details on categorical semantics.

We employ the following convention for naming formulae and stoups:
\begin{center}
  \begin{tabular}{|@{\;}l@{\qquad}l@{\;}|}
    \hline
  $P$ & positive formula \\
  $N$ & negative formula\\
  $Q$ & positive or atomic formula \\
  $M$ & negative or atomic formula \\
    $T$ & irreducible stoup ($-$ or $M$)\\ \hline
\end{tabular}
    \end{center}
%$P$ denotes a positive formula, $N$ a negative formula, $Q$ a positive or atomic formula, $M$ a negative or atomic formula, $T$ an irreducible stoup. All naming conventions, as well as other annotations on formulae and sequents that will be introduced in forthcoming sections, are collected in \Cref{fig:convention}.

%\begin{figure}[t]
%    \begin{center}
%  \begin{tabular}{|l|l|}
%    \hline
%    \multicolumn{2}{|l|}{Naming conventions} \\
%    \hline
%  $P$ & positive formula \\
%  $N$ & negative formula\\
%  $Q$ & positive or atomic formula \\
%  $M$ & negative or atomic formula \\
%    $T$ & irreducible stoup ($-$ or $M$)\\[4pt]
%    \hline
%    \multicolumn{2}{|l|}{Proof search phases in \Cref{fig:multi-focus}} \\
%    \hline
%    $S \mid \Gamma \up A$ & asynchronous (or invertible) \\
%    $S \mid \Gamma \dn A$ & synchronous (or focusing) \\
%    $Q \lf S ; \Gamma$ & left synchronous \\
%    $T \lf \Gamma ; A$ & right synchronous \\
% \hline
%\end{tabular}
%    \end{center}
%    \caption{Naming conventions and annotations} 
%  \label{fig:convention}
%\end{figure}


\section{A Multi-Focused Sequent Calculus}\label{sec:focus}

We now present a multi-focused sequent calculus for \SkNMILL, which draws  inspiration from   the one given by Chaudhuri et al. for multiplicative-additive classical linear logic \cite{chaudhuri:canonical:2008}. Inference rules are given in \Cref{fig:multi-focus}. As in the original formulation by Andreoli \cite{andreoli:logic:1992}, the (multi-)focused calculus describes, in a declarative fashion, a root-first proof search strategy in the original sequent calculus.
% \begin{figure}[t]
%   \[
%   \small
% %  \def\arraystretch{2.5}
%   \begin{array}{c}
%     \multicolumn{1}{l}{\text{\textsc{Asynchronous Phase}}} \\[4pt]
%       \infer[\lolliR]{S \mid \Gamma \up A \lolli B}{S \mid \Gamma , A \up B}
%     \qquad
%     \infer[\otL]{A \ot B \mid \Gamma \up Q}{A \mid  B , \Gamma \up Q}
%     \qquad
%       \infer[\IL]{\I \mid \Gamma \up Q}{- \mid \Gamma \up Q}    
%     \qquad
%         \infer[\foc]{T \mid \Gamma \up Q}{
%       T \mid \Gamma \dn Q
%     }
%     \\[4pt]
%     \multicolumn{1}{l}{\text{\textsc{Synchronous Phase}}} \\[4pt]
%         \infer[\focL]{T \mid \Gamma \dn \dbox{$A$}_{\, b}}{
%       \fbox{$T$} \mid \Gamma \dn \dbox{$A$}_{\, b}
%         }
%     \qquad
%     \infer[\focR]{\dbox{$S$}_{\, b} \mid \Gamma \dn Q}{
%       \dbox{$S$}_{\, b} \mid \Gamma \dn \fbox{$Q$}
%     }
%     \qquad
%         \infer[\ax]{\dbox{$X$}_{\, b} \mid ~ \dn \dbox{$X$}_{\, b'}}{}
%     \\[6pt]
%     \infer[\unfoc]{\dbox{$S$}_{\,b} \mid \Gamma \dn \dbox{$A$}_{\,b'}}{
%       S \mid \Gamma \up A
%       &
%       (b = 1 \supset S = P)
%       &
%       (b' = 1 \supset A = N)
%       &
%       (b \vee b' = 1)
%     }
%     \\
%     \multicolumn{1}{l}{\text{\textsc{Left-Focusing Phase}}} \\[4pt]
%     \infer[\pass]{\fbox{$-$} \mid A , \Gamma \dn \dbox{$C$}_{\, b}}{
%       \fbox{$A$} \mid \Gamma \dn \dbox{$C$}_{\, b}
%     }
%     \qquad
%     \infer[\lolliL]{\fbox{$A \lolli B$} \mid \Gamma , \Delta \dn \dbox{$C$}_{\,b}}{
%       - \mid \Gamma \up A
%       &
%       \fbox{$B$} \mid \Delta \dn \dbox{$C$}_{\,b}
%     }
%     \qquad
%         \infer[\blurL]{\fbox{$Q$} \mid \Gamma \dn \dbox{$A$}_{\,b}}{
%       \dbox{$Q$} \mid \Gamma \dn \dbox{$A$}_{\,b}
%       }    
%     \\[4pt]
%     \multicolumn{1}{l}{\text{\textsc{Right-Focusing Phase}}} \\[4pt]
%     \infer[\IR]{- \mid ~ \dn \fbox{$\I$}}{}
%     \qquad
%     \infer[\otR]{\dbox{$S$}_{\,b} \mid \Gamma , \Delta \dn \fbox{$A \ot B$}}{
%       \dbox{$S$}_{\,b} \mid \Gamma \dn \fbox{$A$}
%       &
%       - \mid \Delta \up B
%     }
%     \qquad
%         \infer[\blurR]{\dbox{$S$}_{\,b} \mid \Gamma \dn \fbox{$M$}}{
%       \dbox{$S$}_{\,b} \mid \Gamma \dn \dbox{$M$}
%     }
%     \end{array}
%   \]
%   \caption{Multi-focused sequent calculus for \SkNMILL.} 
%   \label{fig:multi-focus}
% \end{figure}
\begin{figure}[t]
  \[
  \small
%  \def\arraystretch{2.5}
  \begin{array}{c}
    \multicolumn{1}{l}{\text{\textsc{Asynchronous Phase}}} \\[4pt]
      \infer[\lolliR]{S \mid \Gamma \up A \lolli B}{S \mid \Gamma , A \up B}
    \qquad
    \infer[\otL]{A \ot B \mid \Gamma \up Q}{A \mid  B , \Gamma \up Q}
    \qquad
      \infer[\IL]{\I \mid \Gamma \up Q}{- \mid \Gamma \up Q}    
    \qquad
        \infer[\foc]{T \mid \Gamma \up Q}{
      T \mid \Gamma \dn Q
    }
    \\[4pt]
    \multicolumn{1}{l}{\text{\textsc{Synchronous Phase}}} \\[4pt]
        \infer[\focL]{T \mid \Gamma , \Delta \dn \dbox{$A$}_{\, b}}{
          T \mid \Gamma \lf Q &
          \dbox{$Q$} \mid \Delta \dn \dbox{$A$}_{\, b}
        }
    \qquad
    \infer[\focR]{\dbox{$S$}_{\, b} \mid \Gamma,\Delta \dn Q}{
      \dbox{$S$}_{\, b} \mid \Gamma \dn \dbox{$T$}
      &
      T \mid \Delta \rf Q
    }
    \\[6pt]
        \infer[\ax]{\dbox{$X$} \mid ~ \dn \dbox{$X$}}{}
    \qquad
    \infer[\unfoc]{\dbox{$S$}_{\,b} \mid \Gamma \dn \dbox{$A$}_{\,c}}{
      S \mid \Gamma \up A
      &
      \UT(b,c,S,A)
%%       b = 1 \supset S = P
%%       &
%%       c = 1 \supset A = N
%%       &
%%       b \vee c = 1
    }
    \\[4pt]
    \multicolumn{1}{l}{\text{\textsc{Left-Focusing Phase}}} \\[4pt]
    \infer[\pass]{- \mid A , \Gamma \lf Q}{
      A \mid \Gamma \lf Q
    }
    \qquad
    \infer[\lolliL]{A \lolli B \mid \Gamma , \Delta \lf Q}{
      - \mid \Gamma \up A
      &
      B \mid  \Delta \lf Q
    }
    \qquad
        \infer[\blurL]{Q \mid ~ \lf Q}{
      }    
    \\[4pt]
    \multicolumn{1}{l}{\text{\textsc{Right-Focusing Phase}}} \\[4pt]
    \infer[\IR]{- \mid ~ \rf \I}{}
    \qquad
    \infer[\otR]{T \mid \Gamma , \Delta \rf A \ot B}{
      T \mid \Gamma \rf A
      &
      - \mid \Delta \up B
    }
    \qquad
        \infer[\blurR]{M \mid ~ \rf M}{}
    \end{array}
  \]
  \caption{Multi-focused sequent calculus for \SkNMILL.} 
  \label{fig:multi-focus}
\end{figure}

In this calculus, sequents can take four forms, corresponding to four distinct phases of proof search:
\begin{center}
  \begin{tabular}{|@{\;}l@{\qquad}l@{\;}|}
    \hline
    $S \mid \Gamma \up A$ & asynchronous (or invertible) \\
    $S \mid \Gamma \dn A$ & synchronous (or focusing) \\
    $S \mid \Gamma \lf Q$ & left synchronous \\
    $T \mid \Gamma \rf A$ & right synchronous \\
 \hline
\end{tabular}
    \end{center}

Proof search starts in asynchronous phase $S \mid \Gamma \up A$. In this phase, invertible rules are repeatedly applied until both the stoup formula (when present) and the succedent formula become irreducible. We have fixed an order on invertible rules and decided to apply $\lolliR$ before $\IL$/$\otR$, which is enforced by asking the succedent formula in the left invertible rules to be positive or atomic (so we use our notation $Q$). 

Proof search then progresses to the synchronous phase via the rule $\foc$. At this point we can %apply the axiom rule $\ax$ or
choose to focus on the stoup or succedent position.
%Formulae on focus are surrounded by a \emph{solid} box {\small{\fbox{$A$}}}, similarly for stoups on focus. We use notation {\small{$\fbox{$A$}_{\,b}$}}, with $b$ a Boolean value, to denote a formula which is possibly under focus: {\small{$\fbox{$A$}_{\,1} = \fbox{$A$}$}} and {\small{$\fbox{$A$}_{\,0} = A$}}.
The irreducible stoup $T$ is brought under focus with an application of rule $\focL$. At this point the context is split into two parts $\Gamma$ and $\Delta$ and left focusing phase is initiated in the first premise. A proof of $T \mid \Gamma \lf Q$ consists of repeated application of left synchronous rules $\pass$ and $\lolliL$ on stoup $T$ and context $\Gamma$, until the stoup formula becomes the positive or atomic formula $Q$, at which point the left focus is \emph{blurred} by the rule $\blurL$. In synchronous phase, blurred formulae are surrounded by a \emph{dashed} box ${\small{\dbox{$A$}}}$. We use notation {\small{$\dbox{$A$}_{\,b}$}}, with $b$ a Boolean value, to denote a formula which is possibly blurred: {\small{$\dbox{$A$}_{\,1} = \dbox{$A$}$}} and {\small{$\dbox{$A$}_{\,0} = A$}}. Blurred formulae are used to remember that a certain left or right synchronous phase has been performed.

Proof search can also proceed by bringing the succedent formula $Q$ under focus with an application of rule $\focR$. The context is split into two parts $\Gamma$ and $\Delta$ and right focusing phase is initiated in the second premise. The right focusing phase consists of repeated applications of the right synchronous rule $\otR$. The optional formula $T$ in sequent $T \mid \Delta \rf Q$ indicates whether the right focusing phase terminates when the succedent formula becomes negative or atomic (in which case $T = M$) or it terminates with an application of $\IR$ (in which case $T = -$). In the first case, the succedent formula $M$ is blurred by the rule $\blurR$. The notation $\small\dbox{$S$}_{\, b} \mid \Gamma \dn \dbox{$T$}$ is an abbreviation for: $\small\dbox{$S$}_{\, b} \mid \Gamma \dn \dbox{$M$}$, when $T = M$, while its set of proofs is a singleton if $T = -$. In other words, $\focR$ does not have a first premise in case the proof of the second premise ends with $\IR$.

A couple of observations on left- and right-focusing.
A peculiarity of the sequent calculus in \Cref{fig:multi-focus}, when compared with other (multi-)focused calculi appearing in the literature, e.g. the one in \cite{chaudhuri:canonical:2008}, is that during the application of non-invertible rules in the focusing phase, one of the premises always releases the focus. In rule $\otR$, the right premise releases the focus on the succedent formula, and similarly for the  first premise in rule $\lolliL$. Without the loss of focus in these premises, the multi-focused sequent calculus would not be complete wrt. the calculus in \Cref{fig:seqcalc}, e.g. the sequent $X \mid Y  \ot Z \up X \ot (Y \ot Z)$ would not admit a derivation. This behaviour was already present in the focused sequent calculi for the $\ot$- and $(\I,\ot)$-fragments of the sequent calculus, originally studied by Zeilberger et al. \cite{zeilberger:semiassociative:19,uustalu:sequent:2021}.

The design of rule $\focL$, with a whole left-focusing phase compressed in a proof of $T \mid \Gamma \lf Q$, is chosen specifically for the purpose of maximal multi-focusing, where we will be interested in whether a certain left-focusing phase has happened rather than the specific left synchronous rules that have been applied. Notice also that in the first premise $T \mid \Gamma \lf Q$ of $\focL$ there is no need to keep track of the succedent formula $A$ since it is not affected by left synchronous rules, similarly for the context $\Delta$ of the second premise. Analogous observations apply to $\focR$.


When the (left-) right-focusing phase terminates, one can subsequently choose to focus on the (succedent) stoup formula. If both left- and right-focusing lead to valid derivations, they can be performed in any order, first left then right, or vice versa. When no formula is under focus anymore, we \emph{unfocus} and continue proof search in asynchronous phase. In order to unfocus, formulae that were previously under focus, which are now blurred, must have switched their polarity, which is reflected in the side condition $\UT(b,c,S,A)$ of rule $\unfoc$ ($\UT$ stands for ``unfocusing table''):
\[\small
\begin{array}{|@{\;}c@{\;}|@{\;}c@{\;}|@{\;}c@{\;}|}
  \hline
b & c & \UT(b,c,S,A) \\
\hline
0 & 0 & 0 \\
0 & 1 & A = N \\
1 & 0 & S = P \\
1 & 1 & S = P \vee (S = X \wedge A = N)\\
  \hline
\end{array}
\]
The stoup formula must be positive if it was under focus ($b=1$) but the succedent was not ($c=0$). Dually, the succedent formula must be negative is it was under focus ($c = 1$) and the stoup formula was not ($b = 0$). If both formulae were under focus ($b = 1 \wedge c = 1$), one of them must have changed its polarity: either the stoup formula has become positive or, if it had become (or stayed)  atomic, the succedent formula has become negative. Unfocusing also requires that at least one formula was previously under focus, hence the condition $b \vee c$ must be true.
%The axiom rule is usable only if both stoup and succedent formulae were under focus.

For a sequent with atomic stoup and positive succedent $X \mid \Gamma \up P$ (or, dually, negative stoup and atomic succedent), one can choose whether to focus on the stoup formula or not, and both choices may lead to a valid proof. For an example, consider the valid sequent $X \mid ~ \up (Y \lolli (X \ot Y)) \ot I$. This situation was also present in the multi-focused calculus for classical linear logic \cite{chaudhuri:canonical:2008}, where in similar circumstances one was given the choice of focusing on negated atoms or not.
%, e.g. there exist two distinct multi-focused proofs of $\vdash a^\bot,(a \rotatebox[origin=c]{180}{\&} \bot) \otimes \I$.
%This form of non-determinism can be removed by forcing the focus on atomic formulae, which can be achieved by slighly modifying the side condition in the $\unfoc$ rule: if $b = 1$ then $S=P$ but also $A \not= X$ ($A$ not atomic), and if $b' = 1$ then $A = N$ but also $S \not= X$.

Invertible rules are easily proved to be admissible in the $\up$ phase (with a general formula as succedent), and similarly $\IR$ and  $\ax$:
%\begin{proposition}
%  The following rules are admissible:
  \begin{equation}\label{eq:inv}
  \small
  \begin{array}{c}
    \infer[\otL_\up]{A \ot B \mid \Gamma \up C}{A \mid  B , \Gamma \up C}
    \qquad
    \infer[\IL_\up]{\I \mid \Gamma \up C}{- \mid \Gamma \up C}
    \qquad
%%    \infer[\pass_\up]{- \mid A , \Gamma \up C}{
%%      A\mid \Gamma \up C
%%    }
%%    \;\
    \infer[\IR_\up]{- \mid ~ \up \I}{}
    \qquad
    \infer[\ax_\up]{X \mid ~ \up X}{}    
  \end{array}
  \end{equation}
%\end{proposition}
Rule $\otR$ of \Cref{fig:seqcalc}, with $\vdash$ replaced everywhere by $\up$, is also admissible, but showing this requires more work. We prove the admissibility of a \emph{macro} inference rule corresponding to multiple application of $\otR$. To this end, given a formula $A$ and a list of formulae $\Gamma = B_1,\dots,B_n$, define $A \ot^* \Gamma = (((A \ot B_1) \ot B_2) \ot \dots) \ot B_n$, which is simply $A$ when $\Gamma$ is empty. If $\Gamma$ is non-empty, we write $A \ot^+ \Gamma$. Define also $\Gamma \lolli^* A = B_1 \lolli (B_2 \lolli (\dots \lolli (B_n \lolli A)))$ and similarly $\Gamma\lolli^+ A$ when $\Gamma$ is non-empty.
\begin{proposition}\label{prop:otR}
  Let $\vec{\Delta} = \Delta_1,\dots,\Delta_n$ be a list of contexts and $\vec{B} = B_1,\dots,B_n$ a list of formulae, both non-empty.
  The following rule is admissible:
  \begin{equation*}\label{eq:otR}  
  \small
  \begin{array}{c}
    \infer[\otR^+_\up]{S \mid \Gamma , \vec{\Delta} \up A \ot^+ \vec{B}}{
      S \mid \Gamma \up A
      &
      \{ - \mid \Delta_i \up B_i \}_{i}
    }
  \end{array}
  \end{equation*}
  where $\{ - \mid \Delta_i \up B_i \}_{i}$ is a collection of premises $- \mid \Delta_i \up B_i$ for each $1 \le i \le n$.
\end{proposition}
\begin{proof}
  The proof proceeds by inspecting the polarity of formula $A$ and then by induction on the structure of the derivation $f : S \mid \Gamma \up A$. When $A$ is negative, we need to strengthen the statement for the induction on $f$ to succeed. So we prove the admissibility of the more general rule:
  \begin{equation*}
    \label{eq:genotR}
    \footnotesize
    \begin{array}{c}
      \infer[\otR^+_{\up N}]{S \mid \Gamma_0 , \vec{\Delta} \up (\Gamma_1 \lolli^+ A) \ot^+ \vec{B}}{
      S \mid \Gamma_0,\Gamma_1 \up A
      &
      \{ - \mid \Delta_i \up B_i \}_{i}
      }
    \end{array}
  \end{equation*}
  The context $\Gamma_1$ serves as an accumulator for dealing with the case $f = \lolliR(f')$:
  \begin{equation*}\label{eq:otRlolliR}
  \scriptsize
  \begin{array}{c}
%    \proofbox{
%    \hspace{-3cm}
    \proofbox{\infer[\otR^+_{\up N}]{S \mid \Gamma_0 , \vec{\Delta} \up (\Gamma_1 {\lolli}^+ (A' {\lolli} B')) \ot^+ \vec{B}}{
      \infer[{\lolli}R]{S \mid \Gamma_0,\Gamma_1\up A' {\lolli} B'}{
        \deduce{S \mid \Gamma_0,\Gamma_1,A'\up B'}{f'}
        }
      &
      \{ - \mid \Delta_i \up B_i \}_{i}
    }} =
%    \\
    %   \hspace{3cm}
    \proofbox{
    \infer[\otR^+_{\up N}]{S \mid \Gamma_0 , \vec{\Delta} \up ((\Gamma_1,A') {\lolli}^+ B') \ot^+ \vec{B}}{
      \deduce{S \mid \Gamma_0,\Gamma_1,A' \up B'}{f'}
      & 
      \{ - \mid \Delta_i \up B_i \}_{i}
    }
    }
  \end{array}
  \end{equation*}
  which type checks since $\Gamma_1 {\lolli}^+ (A' {\lolli} B') = (\Gamma_1,A') {\lolli}^+ B'$.
  Another representative case is $f = \foc(f')$, where right-focusing can be immediately executed:
%   \begin{equation}\label{eq:otR+foc}
%     \footnotesize
%     \proofbox{
%   \infer[\foc]{S \mid \Gamma_0 , \vec{\Delta} \up (\Gamma_1 \lolli^+ A) \ot^+ \vec{B}}{
%     \infer[\focR]{S \mid \Gamma_0 , \vec{\Delta} \dn (\Gamma_1 \lolli^+ A) \ot^+ \vec{B} }{
%       \infer[\otR^+]{S \mid \Gamma_0 , \vec{\Delta} \dn \fbox{$(\Gamma_1 \lolli^+ A)\ot^+\vec{B}$}}{
%         \infer[\blurR]{S \mid \Gamma_0 \dn \fbox{$\Gamma_1 \lolli^+ A$}}{
%           \infer[\unfoc]{S \mid \Gamma_0 \dn \dbox{$\Gamma_1 \lolli^+ A$}}{
%             \infer[\lolliR^+]{S \mid \Gamma_0 \up \Gamma_1 \lolli^+ A}{
%               \infer[\foc]{S \mid \Gamma_0 , \Gamma_1 \up A}{
%             \deduce{S \mid \Gamma_0 , \Gamma_1 \dn A}{f'}
%         }}}}
%       &
%         \{ - \mid \Delta_i \up B_i \}_{i}
%       }
%     }
%   }}
%   \end{equation}
  \begin{equation}\label{eq:otR+foc}
    \footnotesize
    \proofbox{
  \infer[\foc]{T \mid \Gamma_0 , \vec{\Delta} \up (\Gamma_1 {\lolli}^+ Q) {\ot}^+ \vec{B}}{
    \infer[\focR]{T \mid \Gamma_0 , \vec{\Delta} \dn (\Gamma_1 {\lolli}^+ Q) {\ot}^+ \vec{B}}{
      \infer[\unfoc]{T \mid \Gamma_0 \dn \dbox{$\Gamma_1 {\lolli}^+ Q$}}{
        \infer[\lolliR^+]{T \mid \Gamma_0 \up \Gamma_1 {\lolli}^+ Q}{
          \infer[\foc]{T \mid \Gamma_0 , \Gamma_1 \up Q}{
            \deduce{T \mid \Gamma_0 , \Gamma_1 \dn Q}{f'}
          }
        }
      }
      &
      \infer[\otR^+]{\Gamma_1 {\lolli}^+ Q \mid \vec{\Delta} \rf (\Gamma_1 {\lolli}^+ Q) {\ot}^+ \vec{B}}{
        \infer[\blurR]{\Gamma_1 {\lolli}^+ Q \mid ~ \rf \Gamma_1 {\lolli}^+ Q}{}
        &
        \! \{ - \mid \Delta_i \up B_i \}_{i}
      }
    }
  }
  }
%       \infer[\otR^+]{T \mid \Gamma_0 , \vec{\Delta} \dn \fbox{$(\Gamma_1 \lolli^+ A)\ot^+\vec{B}$}}{
%         \infer[\blurR]{T \mid \Gamma_0 \dn \fbox{$\Gamma_1 \lolli^+ A$}}{
%           \infer[\unfoc]{T \mid \Gamma_0 \dn \dbox{$\Gamma_1 \lolli^+ A$}}{
%             \infer[\lolliR^+]{T \mid \Gamma_0 \up \Gamma_1 \lolli^+ A}{
%               \infer[\foc]{T \mid \Gamma_0 , \Gamma_1 \up A}{
%             \deduce{T \mid \Gamma_0 , \Gamma_1 \dn A}{f'}
%         }}}}
%       &
%         \{ - \mid \Delta_i \up B_i \}_{i}
%       }
%     }
%   }}
  \end{equation}
\end{proof}

We now move to the admissibility of left-synchronous rules. To this end, we introduce an inductive ternary (proof-relevant) relation $\L(S\mid\Gamma;A)$ which holds when the antecedent $S\mid \Gamma$ is obtained by repeated applications of left-invertible rules on the antecedent $A \mid ~$, where $A$ is in the stoup and the context is empty:
\begin{equation*}\small
  \infer[\varepsilon]{\L(A\mid ~ ;A)}{}
  \qquad
  \infer[\IL^{-1}]{\L(-\mid\Gamma;A)}{\L(\I\mid\Gamma;A)}
  \qquad
  \infer[\otL^{-1}]{\L(A'\mid B',\Gamma;A)}{\L(A' \ot B'\mid \Gamma;A)}
%  \qquad
%  \infer[\pass^{-1}]{\L(A' \mid\Gamma;A)}{\L(-\mid A',\Gamma;A)}
\end{equation*}
Given a proof $\ell : \L(S\mid\Gamma;A)$, we can turn a derivation $f : S \mid \Gamma,\Delta \up C$ into a derivation $\runL(f,\ell) : A \mid \Delta \up C$:
 \begin{equation}\label{eq:runL}
  \footnotesize
%  \arraycolsep=.7cm%\def\arraystretch{3}
%%  \begin{array}{cc}
  %    (j = 0) \;\;
  \runL(f,\ell) = \quad
  \proofbox{
    \infer*[\;\; (\text{left rules obtained by inverting } \ell)]{A \mid \Delta \up C}{
      \deduce{S \mid \Gamma,\Delta \up C}{f}
    }
    }
%%  &
%%  (j >0) \;\;
%%  \proofbox{
%%     \infer*[\text{run } \ell_1]{D_1 \mid D_2,\dots,D_n ,B,\Delta_1 \up C}{
%%       \infer[\pass]{- \mid D_2,\dots,D_n ,B,\Delta_1 \up C}{
%%         \infer*[\text{run } \ell_2,\dots,\ell_n]{D_2 \mid \dots,D_n ,B,\Delta_1 \up C}{
%%%           \infer*[\text{run } \ell_n]{D_n \mid B,\Delta_1 \up C}{
%%             \infer[\pass]{- \mid B,\Delta_1 \up C}{
%%               \infer*[\text{run } \ell]{B \mid \Delta_1 \up C}{
%%                 \deduce{S \mid \Delta_0,\Delta_1 \up C}{g}
%%               }}}}}}
%%  \end{array}
 \end{equation}
\begin{proposition}\label{prop:lolliL}
  The following rules are admissible:
  \begin{equation*}\label{eq:passlolliL}
  \small
  \begin{array}{c}
    \infer[\pass_\up]{- \mid A,\Gamma \up C}{
      A \mid \Gamma \up C}
    \qquad
    \infer[\lolliL^+_\up]{\vec{A} \lolli^+ B \mid \vec{\Gamma} , \Delta \up C}{
      \{ - \mid \Gamma_i \up A_i \}_{i}
      &
      B \mid \Delta \up C
    }
  \end{array}
  \end{equation*}
%  where, in the second rule, $\vec{\Gamma}$ and $\vec{A}$ have both length $n>0$.
\end{proposition}
\begin{proof}
  We only discuss $\lolliL^+$. Proving its admissibility proceeds by inspecting the polarity of formula $B$ and then by induction on the structure of the derivation $g : B \mid \Delta \up C$. When $B$ is positive, we need to strengthen the statement for the induction to succeed. We prove the admissibility of the more general rule:
  \[
  \small
  \begin{array}{c}
    \infer[\lolliL^+_{\up P}]{\vec{A} \lolli^+ B \mid \vec{\Gamma} , \Delta_1 \up C}{
      \{ - \mid \Gamma_i \up A_i \}_{i}
      &
      S \mid \Delta_0,\Delta_1 \up C
      &
      \L(S\mid \Delta_0;B)
    }
  \end{array}
  \]
%  Here $\vec{D}$ is a possibly empty list of formulae, and $\mathsf{hd}$ and $\mathsf{tl}$ are the head and tail operations on non-empty lists.
  The additional assumption $\ell:\L(S\mid \Delta_0;B)$ serves as an accumulator for dealing with the cases when $g$ is a left-invertible rule
  %: \L(S\mid \Delta_0;B)$ %serve as accumulators for dealing with the case in which $g$ is a left-invertible rule or passivation. These assumptions
  and it allows to state that the proof of the second premise is a subderivation of sequent $B \mid \Delta_1 \vdash C$ as depicted in (\ref{eq:runL}). A representative case is $g = \foc(g)$, where we can immediately execute left-focusing, obtaining a derivation dual to the one in (\ref{eq:otR+foc}).
  %obtained by repeated applications of left-invertible rules and passivation. More explicitly:
  %if $j = 0$, so $\vec{D}$ is empty, then $g$ is the subderivation on the left; if $j>0$ it is the subderivation on the right:
  %Assumption $\ell$ serves as an accumulator for dealing with the cases when $g$ is a left-invertible rule. Its employment is similar to the one of the additional context $\Gamma_1$ in (\ref{eq:otRlolliR}).
%  Assuming proofs $f : S \mid \Delta_0,\Delta_1 \up C$ and $\ell : \L(S\mid \Delta_0;B)$ entails the existence of a proof of $B \mid \Delta_1 \up C$.
\end{proof}

The multi-focused sequent calculus in \Cref{fig:multi-focus} is sound and complete wrt. the sequent calculus in \Cref{fig:seqcalc}. 
Let $\Prf(S \mid \Gamma \vdash A)$ and $\Prf(S \mid \Gamma \up A)$ be the sets of proofs of the sequent $S \mid \Gamma \vdash A$ and $S \mid \Gamma \up A$, respectively.
\begin{theorem}\label{thm}
  There exist functions $\focus : \Prf(S \mid \Gamma \vdash A) \to \Prf(S \mid \Gamma \up A)$  and $\emb: \Prf(S \mid \Gamma \up A) \to \Prf(S \mid \Gamma \vdash A)$, turning sequent calculus derivations into multi-focused derivations, and vice versa.
\end{theorem}
\begin{proof}
Function $\emb$ is obtained by erasing all phase-shifting rules and dashed boxes around blurred formulae. Function $\focus$ is defined by induction on the structure of the input derivation, noticing that each rule in \Cref{fig:seqcalc} has an admissible counterpart in the multi-focused sequent calculus, which follows from (\ref{eq:inv}) and \Cref{prop:otR,prop:lolliL}.
\end{proof}

Multi-focused proofs are not canonical wrt. to the equational theory in \Cref{fig:circeq}. During proof search, when the stoup formula is negative and the succedent is positive, we have the choice of left-focusing and subsequently unfocus, right-focusing and subsequently unfocus, or performing both left- and right-focusing before unfocusing, and the latter can also be achieved in two distinct ways.
For example, there exist four distinct proofs of $X \lolli \I \mid X , Y \up (Z \lolli Z) \ot Y$ which correspond to four $\circeq$-related derivations in the unfocused sequent calculus.
As discussed before, in general we also have the choice of whether focusing on atomic formulae or not. %Another form of non-determinism is given by passivation and its interaction with $\otR$: when the succedent formula is a tensor and the context is non-empty, we may have the choice of first passivate and then right-focus or vice versa, and often both possibilities lead to valid derivations.

It is possible to capture the remaining non-determinism in a congruence relation $\circeq_\up$ on derivations of sequents $S \mid \Gamma \up A$. This is inductively specified simultaneously with congruences $\circeq_\dn$, $\circeq_\mathsf{lf}$ and $\circeq_\mathsf{rf}$. The generators of this collection of relations are given in \Cref{sec:app}. It is possible to show that functions $\focus$ and $\emb$ respect congruences $\circeq$ and $\circeq_\up$, and moreover define an equivalence between sets of proofs in the different sequent calculi, strengthening the statement of \Cref{thm}.
%It is also possible to show that the relation $\circeq_\up$ is sound and complete wrt. the equivalence of derivations $\circeq$ in \Cref{fig:circeq}.
\begin{theorem}\label{thmeq}
  Functions $\focus$ and $\emb$ underlie an isomorphism between the set of proofs of a sequent $S \mid \Gamma \vdash A$ quotiented by the equivalence relation $\circeq$ and the set of proofs of $S \mid \Gamma \up A$ quotiented by the equivalence relation $\circeq_\up$.
\end{theorem}
Details about the proof can be found in our Agda formalization.
%The calculus of maximally multi-focused derivations introduced in the next section is designed to restrict this non-determinism.

%%\niccolo{Change the next part}
%%Multi-focusing resolves most of the permutative non-determinism in the sequent calculus. Let $\circeq'$ be the congruence generated by the equations in \Cref{fig:circeq} except the last two involving $\otR/\pass$ and $\otR/\lolliL$.
%%\begin{proposition}
%%  If $f \circeq' g$ then $\focus(f) = \focus(g)$. Moreover, for all $f : S \mid \Gamma \up A$, $\focus(\emb(f)) = f$.
%%\end{proposition}
%%Dealing with the last equation in \Cref{fig:circeq} require a shift to a calculus of maximally multi-focused derivations.

%  \begin{enumerate}
%  \item If $A$ is positive or atomic, so $A = Q$, then we continue by induction on the structure of the given derivation $f : S \mid \Gamma \up Q$. There are two interesting cases. If $f$ left-focuses, so it is of the form $\foc(\lolliL^+(\{f_j\}_j,\blurL(h)))$, we return
%    \[\footnotesize%\small
%      \infer[\foc]{\vec{A} \lolli P \mid \vec{\Gamma},\Lambda,\vec{\Delta} \up Q \ot \vec{B}}{
%      \infer[\focL]{\vec{A} \lolli P \mid \vec{\Gamma},\Lambda,\vec{\Delta} \dn Q \ot \vec{B}}{
%        \infer[\lolliL^+]{\fbox{$\vec{A} \lolli P$} \mid \vec{\Gamma}, \Lambda, \vec{\Delta} \dn Q \ot \vec{B}}{
%          \deduce{\{ - \mid \Gamma_j \up A_j\}}{f_j}
%          &
%          \infer[\blurL]{\fbox{$P$} \mid \Lambda, \vec{\Delta} \dn Q \ot \vec{B}}{
%          \infer[\unfoc]{\dbox{$P$} \mid \Lambda, \vec{\Delta} \dn Q \ot \vec{B}}{
%            \infer[\otR^+_{\up}]{P \mid \Lambda, \vec{\Delta} \up Q \ot \vec{B}}{
%              \deduce{P \mid \Lambda \up Q}{h}
%      &
%      \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}
%        }
%      }
%        }
%      }
%    }}
%    \]    
%  \end{enumerate}
%\end{proof}

\section{Maximal Multi-Focusing Using Tags}\label{sec:maxfocus}

In order to design a calculus of permutative-canonical derivations, we have to answer the following question: in which situation does a right-focusing phase \emph{need} to be performed strictly before a left-focusing phase? And dually, when must left-focusing be done before right-focusing? 
Consider the valid sequent $X \lolli Y \mid Z \dn (X \lolli Y) \ot Z$. Attempting to focus on the stoup formula would fail, because no splitting of the context, consisting of the singleton formula $Z$, leads to a valid derivation. We would be able to appropriately split the context only after performing right-focusing, specifically after an application of $\otR$, and a subsequent application of $\lolliR$. This is because the formula  $X$, that we would like to send to the first premise during left-focusing, is not initially in context, it becomes available only after right-focusing. 

Dually, consider the valid sequent $X \lolli (Y \ot Z) \mid X \dn Y \ot Z$. It is not hard to see that any attempt to focus on the succedent formula would fail. But after left-focusing and an application of $\otL$, right-focusing becomes possible and leads to a valid proof. This is because the formula $Z$, which should be sent to the second premise by $\focR$, appears in context only after executing the left-focusing phase. Another simple example is given by the valid sequent $- \mid X \ot Y \dn X \ot Y$. Again left-focusing, specifically $\pass$, must happen before right-focusing, since the formula $Y$ is not in context and cannot otherwise be sent to the second premise during right-focusing.

We need a mechanism for keeping track of \emph{new} formulae appearing in context from application of invertible rules $\otL$ and $\lolliR$. In proof search, when we choose to perform left-focusing but we decide to postpone right-focusing, after releasing the focus we have to justify this decision by showing that the subsequent application of $\focR$ splits the context in-between new formulae that appeared in context only after the termination of the left-focusing phase. And dually if right-focusing strictly precedes left-focusing.

We employ a mechanism from the recent work of Uustalu et al. \cite{UVW:protsn} which was inspired by Scherer and R{\'e}my's saturation for intuitionistic logic \cite{scherer:simple:2015}. Formulae appearing in a sequent will now be decorated with a Boolean value, which we call a \emph{tag}. Visually, we use colors to represent tags: green $\green{A}$ if the tag is $0$, red $\red{A}$ if the tag is $1$.
%The mnemonic is that a red tag denotes a formula or a stoup that we should pay attention to. 
Stoups are also tagged: $\green{S}$ or $\red{S}$. Tagged contexts consist of tagged formulae. If we do not specify the color of a formula (or stoup or context) we simply write it in black color $A$ (or $S$ or $\Gamma$). Sequents in the maximally multi-focused sequent calculus $S \mid \Gamma \upm A$ and $S \mid \Gamma \dnm A$ are triples of a tagged stoup $S$, a tagged context $\Gamma$ and a tagged formula $A$. Tags serve two purposes:
\begin{enumerate}
\item They are used to remember which (if any) among left- or right-focusing was \emph{not} performed during the preceding focusing phase. If the stoup is red $\red{S}$, only right-focusing was previously executed. Dually, if the succedent formula is red $\red{A}$, only left-focusing took place. \item In case one (and only one) among the stoup and the succedent is red, new formulae moved to context via the application of invertible rules become red. So tags are also used to remember which formulae in context are new.
\end{enumerate}
\begin{figure}[t]
  \[
  \small
%  \def\arraystretch{2.5}
  \begin{array}{c}
    \multicolumn{1}{l}{\text{\textsc{Asynchronous Phase}}} \\[4pt]
      \infer[\lolliR]{\blue{S} \mid \Gamma \upm A \lolli B}{\blue{S} \mid \Gamma , \blue{A} \upm B}
    \quad
    \infer[\otL]{A \ot B \mid \Gamma \upm \blue{Q}}{A\mid  \blue{B} , \Gamma \upm \blue{Q}}
    \quad
      \infer[\IL]{\I \mid \Gamma \upm Q}{- \mid \Gamma \upm Q}    
    \quad
        \infer[\foc]{T \mid \Gamma \upm Q}{
      T \mid \Gamma \dnm Q
    }
    \\[6pt]
    \multicolumn{1}{l}{\text{\textsc{Synchronous Phase}}} \\[4pt]
        \infer[\red{\focL}]{\red{T} \mid \Gamma , \Delta \dnm A}{
          \green{T} \mid \green{\Gamma} \lfm \green{Q} &
          \dbox{$\green{Q}$} \mid \Delta \dnm A
          & \red{\bullet} \in \Gamma
        }
    \qquad
        \infer[\focL]{\green{T} \mid \Gamma , \Delta \dnm A}{
          \green{T} \mid \green{\Gamma} \lfm \green{Q} &
          \dbox{$\green{Q}$} \mid \Delta \dnm A
        }
        \\[6pt]
    \infer[\red{\focR}]{\dbox{$S$}_{\, b} \mid \Gamma,\Delta \dnm \red{Q}}{
      \dbox{$S$}_{\, b} \mid \Gamma \dnm \dbox{$\green{T}$}
      &
      \green{T} \mid \green{\Delta} \rfm \green{Q}
      & T = M \supset \red{\bullet} \in \Delta
    }
    \;\;
    \infer[\focR]{\dbox{$S$}_{\, b} \mid \Gamma,\Delta \dnm \green{Q}}{
      \dbox{$S$}_{\, b} \mid \Gamma \dnm \dbox{$\green{T}$}
      &
      \green{T} \mid \green{\Delta} \rfm \green{Q}
    }
    \\[4pt]
        \infer[\ax]{\dbox{$\green{X}$} \mid ~ \dnm \dbox{$\green{X}$}}{}
    \qquad
    \infer[\unfoc]{\dbox{$\green{S}$}_{\,b} \mid \Gamma \dnm \dbox{$\green{A}$}_{\,c}}{
      S^{\neg b} \mid \green{\Gamma} \upm A^{\neg c}
      &
      \UT(b,c,S,A)
%%       b = 1 \supset S = P
%%       &
%%       c = 1 \supset A = N
%%       &
%%       b \vee c = 1
    }
%     \multicolumn{1}{l}{\text{\textsc{Synchronous Phase}}} \\[4pt]
%         \infer[\focL]{T \mid \Gamma \dn A}{
%       \fbox{$T$} \mid \Gamma \dn A
%         }
%     \qquad
%     \infer[\focR]{\dbox{$S$}_{\, b} \mid \Gamma \dn Q}{
%       \dbox{$S$}_{\, b} \mid \Gamma \dn \fbox{$Q$}
%     }
%     \qquad
%         \infer[\ax]{\dbox{$\green{X}$} \mid ~ \dn \dbox{$\green{X}$}}{}
%     \\[6pt]
%     \infer[\unfoc]{\dbox{$\green{S}$}_{\,b} \mid \Gamma \dn \dbox{$\green{A}$}_{\,c}}{
%       S^{\neg b} \mid \green{\Gamma} \up A^{\neg c}
%       &
%       b = 1 \supset S = P
%       &
%       c = 1 \supset A = N
%       &
%       b \vee c = 1
%     }
%     \\
%     \multicolumn{1}{l}{\text{\textsc{Left-Focusing Phase}}} \\[4pt]
%     \infer[\pass]{\fbox{$-$} \mid A , \Gamma \dn \dbox{$C$}_{\, b}}{
%       \fbox{$A$} \mid \Gamma \dn \dbox{$C$}_{\, b}
%     }
%     \qquad
%     \infer[\red{\pass}]{\fbox{$\red{-}$} \mid \red{A} , \Gamma \dn \dbox{$C$}_{\, b}}{
%       \fbox{$\green{A}$} \mid \Gamma \dn \dbox{$C$}_{\, b}
%     }
%     \qquad
%         \infer[\blurL]{\fbox{$\green{Q}$} \mid \Gamma \dn \dbox{$A$}_{\,b}}{
%       \dbox{$\green{Q}$} \mid \Gamma \dn \dbox{$A$}_{\,b}
%       }    
%     \\[6pt]
%     \infer[\lolliL]{\fbox{$A \lolli B$} \mid \Gamma , \Delta \dn \dbox{$C$}_{\,b}}{
%       \green{-} \mid \green{\Gamma} \up \green{A}
%       &
%       \fbox{$B$} \mid \Delta \dn \dbox{$C$}_{\,b}
%     }
%     \qquad
%     \infer[\red{\lolliL}]{\fbox{$\red{A \lolli B}$} \mid \Gamma , \Delta \dn \dbox{$C$}_{\,b}}{
%       \green{-} \mid \green{\Gamma} \up \green{A}
%       &
%       \fbox{$\green{B}$} \mid \Delta \dn \dbox{$C$}_{\,b}
%       &
%       \red{D} \in \Gamma
%     }    
%     \\[4pt]
%     \multicolumn{1}{l}{\text{\textsc{Right-Focusing Phase}}} \\[4pt]
%     \infer[\IR]{- \mid ~ \dn \fbox{$\I$}}{}
%     \qquad
%     \infer[\blurR]{\dbox{$S$}_{\,b} \mid \Gamma \dn \fbox{$\green{M}$}}{
%       \dbox{$S$}_{\,b} \mid \Gamma \dn \dbox{$\green{M}$}
%     }
%     \\[6pt]
%     \infer[\otR]{\dbox{$S$}_{\,b} \mid \Gamma , \Delta \dn \fbox{$A \ot B$}}{
%       \dbox{$S$}_{\,b} \mid \Gamma \dn \fbox{$A$}
%       &
%       \green{-} \mid \green{\Delta} \up \green{B}
%     }
%     \qquad    
%     \infer[\red{\otR}]{\dbox{$S$}_{\,b} \mid \Gamma , \Delta \dn \fbox{$\red{A \ot B}$}}{
%       \dbox{$S$}_{\,b} \mid \Gamma \dn \fbox{$A$}
%       &
%       \green{-} \mid \green{\Delta} \up \green{B}
%       &
%       \red{D} \in \Delta
%     }
    \end{array}
  \]
  \caption{Maximally multi-focused sequent calculus for \SkNMILL.} 
  \label{fig:max-multi-focus}
\end{figure}

Inference rules for the maximally multi-focused sequent calculus are displayed in \Cref{fig:max-multi-focus}. In rule $\lolliR$, the blue color for the stoup $\blue{S}$ and the formula $\blue{A}$ indicates that they must have the same color, both green or both red. If the stoup is red, so left-focusing did not happen in the previous synchronous phase, we track the new formula $A$ moving to the right-most end of the context by making it also red.
Similarly for blue formulae $\blue{A}$ and $\blue{Q}$ in rule $\otL$.

Proof search starts again in asynchronous phase, where initially the sequent is all green $\green{S} \mid \green{\Gamma} \upm \green{A}$. At this point of the search, this phase is analogous to the one in the multi-focused calculus of \Cref{fig:multi-focus}. Red color may start to appear with an application of $\unfoc$. If left-focusing was not performed, so $b = 0$, then the stoup is turned red, which in the rule is denoted $S^{\neg b}$ (remember that 0 is green and 1 is red). If right-focusing was not executed, so $c = 0$, then the succedent becomes red $A^{\neg c}$. If either the stoup or the succedent is red, new formulae moved to the context by $\lolliR$ and $\otL$ are also assigned red tag.

If we want to left-focus, we first inspect the color of the stoup formula. If it is red $\red{T}$, we need to justify \emph{why} left-focusing was not performed together with right-focusing in the preceding synchronous phase. This can be done by requiring a red formula to appear in $\Gamma$, as in the side condition $\red{\bullet} \in \Gamma$ in the premise of $\red{\focL}$. Proof search continues with a green stoup formula $\green{Q}$. Dually, if we want to right-focus and the succedent is red $\red{Q}$, and moreover $T$ is non-empty, we require a red formula to appear in $\Delta$ when applying $\red{\focR}$. When $T$ is empty, so the right-focusing phase terminates with $\IR$, there is no need to check whether $\Delta$ contains red formulae, since right-focusing could not have happened together with the preceding left-focusing phase. Phases $\lfm$ and $\rfm$ are omitted in \Cref{fig:max-multi-focus}, since they are the same as $\lf$ and $\rf$ in \Cref{fig:multi-focus} but with all sequents being green, and $\up$ replaced by $\upm$ in premises of $\lolliL$ and $\otR$.

%During the \emph{red} left-focusing phase (when we initiate left-focusing with a red stoup), we are required to use red formulae in context in a meaningful way: either by passivating a red formula via the rule $\red{\pass}$ or sending a red formula $\red{D}$ to the first premise via the rule $\red{\lolliL}$. When this happens, we have successfully motivated why left-focusing was not executable simultaneously with right-focusing in the preceding synchronous phase, and we can then turn the stoup green, meaning that we can stop caring about tracking red formulae in left-focusing phase. Notice that during red left-focusing we are forced to apply either red rules $\red{\pass}$ or $\red{\lolliL}$, since blurring the left focus now requires the stoup to be green. In the first premise of $\lolliL$ and $\red{\lolliL}$ the whole sequent is turned green.

%Dually, in red right-focusing phase (when right-focusing starts with red succedent), we must  either send a red formula $\red{D}$ to the second premise via the rule $\red{\otR}$ or close the derivation using $\IR$. Again, this appropriately motivates why right-focusing was previously not performable simultaneously with left-focusing. 

When releasing the focus via $\unfoc$, stoup and succedent must be green, meaning that all the reasons for ``not maximally focus'' in a preceding focusing phase must have been succesfully justified. Apart from tags, there are a couple of differences with the multi-focused system in \Cref{fig:multi-focus}.
\begin{enumerate}
  \item In synchronous phase, we have the choice of first applying $\focL$ and then applying $\focR$, i.e. we remove non-determinism in the choice of left- or right-focusing when both are executable. In \Cref{fig:max-multi-focus} this can be observed in $\focL$, where succedents cannot be blurred. %, so right-focusing could not have happened immediately before.
\item Another difference lays in the treatment of atomic formulae. The axiom rule requires $\green{X}$ to be green and blurred in both positions. More generally, %whenever an atomic formula appears in stoup or succedent position, we are required to focus on it.
%\begin{proposition}
each derivation of $X \mid \Gamma \dnm A$ necessarily focuses on the stoup and each derivation of $S \mid \Gamma \dnm X$ necessarily focuses on the succedent.
%In fact, if $f : X \mid \Gamma \dn A$ does not focus on $X$, then it cannot be an axiom. It must exclusively focus on $A$ and successively release the focus, at which point $X$ is turned red. A future application of $\red{\focL}$ (which has to happen in order to finally close the derivation with an axiom) would necessarily fail. In left-focusing phase, $\pass$ and $\lolliL$ are not applicable since the stoup formula is atomic. The only possibility would be $\blurL$, but then the side condition of $\red{\focL}$ would require the presence of a red formula in the empty context. We can similarly argue to show that each proof of $S \mid \Gamma \dn X$ must necessarily right-focus.
%\end{proof}
\end{enumerate}
% Rules $\IL_\up$, $\otR_\up$, $\IR_\up$ and $\ax_\up$ as in (\ref{eq:inv}), with all-green sequents, are easily shown admissible in the maximally multi-focused calculus. The same is true for synchronous rules.
% \begin{proposition}\label{prop:otR}
%   Rules $\otR^+_\up$, $\pass_\up$ and $\lolliL^+_\up$ as in (\ref{eq:otR}) and (\ref{eq:passlolliL}), with all-green sequents, are admissible in the maximally multi-focused sequent calculus.
% \end{proposition}
% \begin{proof}
% We only discuss $\otR^+_{\up}$.  Similarly to \Cref{prop:otR}, the proof proceeds by inspecting the polarity of formula $A$ and, in case it is negative, we have to prove the more general form in (\ref{eq:genotR}) for strengthening the induction hypothesis. When $f = \foc(f') : \green{S} \mid \green{\Gamma_0} , \green{\Gamma_1} \up \green{A}$ we further check whether $f'$ left-focuses or not. In case $f' = \focL(f'')$, we inspect if formulae from $\green{\Gamma_1}$ are meaningfully employed during the left-focusing phase. Is the head formula of $\green{\Gamma_1}$ activated using $\pass$? Is a formula $\green{D} \in \green{\Gamma_1}$ moved to the first premise by an application of $\lolliL$? If this does not happen, then we can focus on both the stoup formula and the succedent formula. But if this situation happens, 
% %  \begin{enumerate}
% %  \item If this happens,
%     we are required to perform right-focusing first, release the focus, apply invertible rules, and only then focusing on the stoup. As a representative example, consider the case $f'' = \lolliL^+(\{f_j\}_j,\blurL(\unfoc(h)))$ with $f_j : \green{-} \mid \green{\Lambda_j} \up \green{C_j}$ for $1 \le j \le m$ and $h : \green{P} \mid \green{\Omega} \up \red{A}$, where $\green{\Gamma_0,\Gamma_1} = \green{\vec{\Lambda}},\green{\Omega}$ and moreover the intersection of $\green{\Gamma_1}$ with some $\green{\Lambda_{j^*}}$ is non-empty, for some index $j^*$. This means that $\green{\Lambda_{j^*}} = \green{\Lambda_{j^*_0}},\green{\Lambda_{j^*_1}}$ with non-empty $\green{\Lambda_{j^*_1}}$ and $\Gamma_1 = \green{\Lambda_{j^*_1}},\green{\Lambda_{j^*+1}},\dots,\green{\Lambda_{m}},\green{\Omega}$. We return:
%   \begin{equation*}\label{eq:otR+focL}
%     \footnotesize
%     \proofbox{
%       \infer[\foc]{\green{\vec{C} \lolli^+ P} \mid \green{\Gamma_0} , \green{\vec{\Delta}} \up (\green{\Gamma_1 \lolli^+ A}) \green{\ot^+ \vec{B}}}{
%         \infer[\focR]{\green{\vec{C} \lolli^+ P} \mid \green{\Gamma_0} , \green{\vec{\Delta}} \dn (\green{\Gamma_1 \lolli^+ A}) \green{\ot^+ \vec{B}}}{
%           \infer[\otR+]{\green{\vec{C} \lolli^+ P} \mid \green{\Gamma_0} , \green{\vec{\Delta}} \dn \fbox{$(\green{\Gamma_1 \lolli^+ A}) \green{\ot^+ \vec{B}}$}}{
%             \infer[\blurR]{\green{\vec{C} \lolli^+ P} \mid \green{\Gamma_0} \dn \fbox{$\green{\Gamma_1 \lolli^+ A}$}}{
%               \infer[\unfoc]{\green{\vec{C} \lolli^+ P} \mid \green{\Gamma_0} \dn \dbox{$\green{\Gamma_1 \lolli^+ A}$}}{
%                 \infer[\lolliR^+]{\red{\vec{C} \lolli^+ P} \mid \green{\Gamma_0} \up \green{\Gamma_1 \lolli^+ A}}{
%                   \infer[\foc]{\red{\vec{C} \lolli^+ P} \mid \green{\Gamma_0},\red{\Gamma_1} \up \green{A}}{
%                     \infer[\focL]{\red{\vec{C} \lolli^+ P} \mid \green{\Gamma_0},\red{\Gamma_1} \up \green{A}}{
%                       \infer={\fbox{$\red{\vec{C} \lolli^+ P}$} \mid \green{\Gamma_0},\red{\Gamma_1} \dn \green{A}}{
%                         \infer[\lolliL^+/\red{\lolliL}]{\fbox{$\red{\vec{C} \lolli^+ P}$} \mid \green{\Lambda_1},\dots,\green{\Lambda_{j^*_0}},\red{\Lambda_{j^*_1}},\dots,\red{\Lambda_m},\red{\Omega} \dn \green{A}}{
%                           \{\green{-} \mid \green{\Lambda_j} \up \green{C_j} \}_j
%                           &
%                           \infer[\blurL]{\fbox{$\green{P}$} \mid \red{\Omega} \dn \green{A}}{
%                             \infer[\unfoc]{\dbox{$\green{P}$} \mid \red{\Omega} \dn \green{A}}{
%                               \deduce{\green{P} \mid \green{\Omega} \up \red{A}}{h}{
%                               }
%                             }
%                           }
%                         }
%                       }
%                     }
%                   }
%                 }
%               }
%             }
%             &
%             \{\green{-} \mid \green{\Delta_i} \up \green{B_i}\}_i
%           }
%         }
%       }
%     }
%   \end{equation*}
%   where the double-line rule is the equality rule (we simply rewrite the contexts) and $\lolliL^+/\red{\lolliL}$ indicate the application of left $\lolli$-rules where one of them is red.
% %%%    \item  As an example, consider again $f'' = \lolliL^+(\{f_j\}_j,\blurL(\unfoc(h)))$  but now the intersection of $\green{\Gamma_1}$ with $\green{\vec{\Lambda}}$ is empty. This means that $\green{\Gamma_0} = \green{\vec{\Lambda}},\green{\Gamma'_{0}}$ for some list of formulae $\green{\Gamma'_{0}}$. We return:
% %%%    \begin{equation*}\label{eq:otR+focL2}
% %%%      \scriptsize
% %%%      \proofbox{
% %%%        \infer[\foc]{\green{\vec{C} \lolli^+ P} \mid \green{\Gamma_0} , \green{\vec{\Delta}} \up (\green{\Gamma_1 \lolli^+ A}) \green{\ot^+ \vec{B}}}{
% %%%          \infer[\focL]{\green{\vec{C} \lolli^+ P} \mid \green{\Gamma_0} , \green{\vec{\Delta}} \dn (\green{\Gamma_1 \lolli^+ A}) \green{\ot^+ \vec{B}}}{
% %%%            \infer={\fbox{$\green{\vec{C} \lolli^+ P}$} \mid \green{\Gamma_0} , \green{\vec{\Delta}} \dn (\green{\Gamma_1 \lolli^+ A}) \green{\ot^+ \vec{B}}}{
% %%%              \infer[\lolliL^+]{\fbox{$\green{\vec{C} \lolli^+ P}$} \mid \green{\vec{\Lambda}},\green{\Gamma'_0} , \green{\vec{\Delta}} \dn (\green{\Gamma_1 \lolli^+ A}) \green{\ot^+ \vec{B}}}{
% %%%                \{\green{-} \mid \green{\Lambda_j} \up \green{C_j} \}_j
% %%%                &
% %%%                \infer[\blurL]{\fbox{$\green{P}$} \mid \green{\Gamma'_{0}} , \green{\vec{\Delta}} \dn (\green{\Gamma_1 \lolli^+ A}) \green{\ot^+ \vec{B}}}{
% %%%                  \infer[\focR]{\dbox{$\green{P}$} \mid \green{\Gamma'_{0}} , \green{\vec{\Delta}} \dn (\green{\Gamma_1 \lolli^+ A}) \green{\ot^+ \vec{B}}}{
% %%%                    \infer[\otR^+]{\dbox{$\green{P}$} \mid \green{\Gamma'_{0}} , \green{\vec{\Delta}} \dn \fbox{$(\green{\Gamma_1 \lolli^+ A}) \green{\ot^+ \vec{B}}$}}{
% %%%                      \infer[\blurR]{\dbox{$\green{P}$} \mid \green{\Gamma'_{0}} \dn \fbox{$\green{\Gamma_1 \lolli^+ A}$}}{
% %%%                        \infer[\unfoc]{\dbox{$\green{P}$} \mid \green{\Gamma'_{0}} \dn \dbox{$\green{\Gamma_1 \lolli^+ A}$}}{
% %%%                          \infer[\lolliR^+]{\green{P} \mid \green{\Gamma'_{0}} \up \green{\Gamma_1 \lolli^+ A}}{
% %%%                            \infer={\green{P} \mid \green{\Gamma'_{0}},\green{\Gamma_1} \up \green{A}}{
% %%%                              \deduce{\green{P} \mid \green{\Omega} \up \green{A}}{h'}
% %%%                            }
% %%%                          }
% %%%                        }
% %%%                      }
% %%%                      &
% %%%                      \{\green{-} \mid \green{\Delta_i} \up \green{B_i}\}_i
% %%%                    }
% %%%                  }
% %%%                }
% %%%              }
% %%%            }
% %%%          }
% %%%        }
% %%%      }
% %%%    \end{equation*}
% %%%    where $h' : \green{P} \mid \green{\Omega} \up \green{A}$ is obtained from $h : \green{P} \mid \green{\Omega} \up \red{A}$ by making all applications of red rules ($\red{\otR}$) in $h$ black ($\otR$). 
% %%%  \end{enumerate}
% \end{proof}
% From the admissibility of all inference rules, we obtain a normalization procedure turning derivations in the sequent calculus into maximally multi-focused derivations. One can also show that this factors through the multi-focused calculus of \Cref{fig:multi-focus} via the function $\focus$ of \Cref{thm}. Moreover, it is possible to prove that proofs in the maximally multi-focused calculus are canonical wrt. the equational theory in \Cref{fig:circeq}.
Each multi-focused derivation can be normalized to a maximally multi-focused one. %We write $\upm$, $\dnm$, $\lfm$ and $\rfm$ for the proof search phases of the maximally multi-focused sequent calculus.
\begin{theorem}\label{thm2}
  There exist functions
  \[
  \begin{array}{l}%{l@{\qquad}l}
    \mathsf{max}_\odot : \Prf(S \mid \Gamma \odot A) \to \Prf(\green{S} \mid \green{\Gamma} \odot_\mathsf{m} \green{A}) \\
%    \mathsf{max}_\dn : \Prf(S \mid \Gamma \dn A) \to \Prf(\green{S} \mid \green{\Gamma} \dnm \green{A}) \\[4pt]
    %\mathsf{max}_{\mathsf{lf}} &: Q \lf S;\Gamma \to \green{Q} \lfm \green{S} ; \green{\Gamma} \\  \mathsf{max}_{\mathsf{rf}} &: T \rf \Gamma;A \to \green{T} \rfm \green{\Gamma} ; \green{A} \\
    \mathsf{untag}_\odot : \Prf(\green{S} \mid \green{\Gamma} \odot_{\mathsf{m}} \green{A}) \to \Prf(S \mid \Gamma \odot A) %\\
%\mathsf{untag}_\dn : \Prf(\green{S} \mid \green{\Gamma} \dnm \green{A}) \to \Prf(S \mid \Gamma \dn A)
%\mathsf{untag}_{\mathsf{lf}} &: \green{Q} \lfm \green{S} ; \green{\Gamma} \to Q \lf S;\Gamma \\  \mathsf{untag}_{\mathsf{rf}} &: \green{T} \rfm \green{\Gamma} ; \green{A} \to T \rf \Gamma;A
  \end{array}
  \]
 for all $\odot \in \{\up,\dn,\lf,\rf \}$, turning multi-focused proofs into maximally multi-focused ones, and vice versa.
\end{theorem}
\begin{proof}
  We only sketch the construction of $\mathsf{max}_\dn$, which is the most challenging one. We refer the interested reader to the associated Agda formalization for the complete proof. The input derivation can either be: $(i)$ an application of $\focR$ followed by $\ax$ or $\unfoc$; $(ii)$ an application of $\focL$ followed by $\ax$ or $\unfoc$; $(iii)$ an application of both $\focL$ and $\focR$. In case $(iii)$, we can safely apply both $\focL$ and $\focR$ in the maximally multi-focused calculus. The most interesting cases are $(i)$ and $(ii$) when the focus is subsequently released. We only look at case $(i)$ when the input derivation is of the form $f = \focR(\unfoc(f'),r)$ for some $f' : S \mid \Gamma \up M$ and $r : M \mid \Delta \rf Q$. To deal with this case, we prove the following rule admissible:% in the maximally multi-focused sequent calculus:
  \begin{equation*}\label{eq:otmax}
    \small
    \proofbox{
    \infer[\focR_{\upm}]{\green{S} \mid \green{\Gamma},\green{\Delta} \upm \green{Q}}{
      \green{S} \mid \green{\Gamma} \upm \green{M}
      &
      \green{M} \mid \green{\Delta} \rfm \green{Q}
    }
    }
  \end{equation*}
  The proof proceeds by checking whether $M$ is atomic or negative. In the latter case we further need to generalize the statement and prove the admissibility of
  \begin{equation*}\label{eq:otmaxneg}
    \small
    \proofbox{
    \infer[\focR_{\upm N}]{\green{T} \mid \green{\Gamma_0},\green{\Delta} \upm \green{Q}}{
      \green{T} \mid \green{\Gamma_0},\green{\Gamma_1} \upm \green{A}
      &
      \green{\green{\Gamma_1} \lolli^+ A} \mid \green{\Delta} \rfm \green{Q}
    }
    }
  \end{equation*}
  We proceed by induction on the structure of the proof of the first premise ${g : \green{T} \mid \green{\Gamma_0},\green{\Gamma_1} \upm \green{A}}$. We look at the case $g = \foc(\focL(l,\unfoc(h)))$ for some $l : \green{T} \mid \green{\Gamma'} \lfm \green{P}$ and $h : \green{P} \mid \green{\Delta'} \upm \red{A}$. In this case, we have the equality of contexts $\green{\Gamma'},\green{\Delta'} = \green{\Gamma_0},\green{\Gamma_1}$ and we check whether $\green{\Gamma_1}$ is split between $\green{\Gamma'}$ and $\green{\Delta'}$, or it is fully contained in $\green{\Delta'}$.
  \begin{enumerate}
  \item If $\green{\Gamma_1} = \green{\Gamma_{1}'},\green{\Delta'}$ and $\green{\Gamma'} =\green{\Gamma_0},\green{\Gamma_{1}'}$ for some non-empty $\green{\Gamma_{1}'}$, then multi-focusing on both stoup and succedent is not possible. We return:
    \[\small
    \infer[\foc]{\green{T} \mid \green{\Gamma_0},\green{\Delta} \upm \green{Q}}{
      \infer[\focR]{\green{T} \mid \green{\Gamma_0},\green{\Delta} \dnm \green{Q}}{
        \infer[\unfoc]{\green{T} \mid \green{\Gamma_0} \dnm \dbox{$\green{\Gamma_1}{\lolli}^+\green{A}$}}{
          \infer[\lolliR^+]{\red{T} \mid \green{\Gamma_0} \upm \green{\Gamma_1}{\lolli}^+\green{A}}{
            \infer={\red{T} \mid \green{\Gamma_0},\red{\Gamma_1} \upm \green{A}}{
              \infer[\foc]{\red{T} \mid \green{\Gamma_0},\red{\Gamma'_1},\red{\Delta'}\upm \green{A}}{
                \infer[\red{\focL}]{\red{T} \mid \green{\Gamma_0},\red{\Gamma'_1},\red{\Delta'} \dnm \green{A}}{
                  \infer={\green{T} \mid \green{\Gamma_0},\green{\Gamma'_1} \lfm \green{P}}{
                    \deduce{\green{T} \mid \green{\Gamma'} \lfm \green{P}}{l}
                  }
                  &
                  \infer[\unfoc]{\dbox{$\green{P}$} \mid \red{\Delta'} \dnm \green{A}}{
                    \deduce{\green{P} \mid \green{\Delta'} \upm \red{A}}{h}
                  }
                }
              }
            }            
          }
        }
        &
        \green{\green{\Gamma_1}{\lolli}^+ A} \mid \green{\Delta} \rfm \green{Q}
      }
    }
    \]
    The double-line rule is the equality rule (we simply rewrite the contexts).    
  \item If $\green{\Gamma_0} = \green{\Gamma'},\green{\Gamma_{0}'}$ and $\green{\Delta'} = \green{\Gamma_{0}'},\green{\Gamma_{1}'}$, then multi-focusing on both stoup and succedent is possible. We return:
    \[\small
    \infer[\foc]{\green{T} \mid \green{\Gamma_0},\green{\Delta} \upm \green{Q}}{
      \infer={\green{T} \mid \green{\Gamma_0} ,\green{\Delta} \dnm \green{Q}}{
        \infer[\focL]{\green{T} \mid \green{\Gamma'},\green{\Gamma_{0}'},\green{\Delta} \dnm \green{Q}}{
          \deduce{\green{T} \mid \green{\Gamma'} \lfm \green{P}}{l}
          &
          \infer[\focR]{\dbox{$\green{P}$} \mid \green{\Gamma_{0}'},\green{\Delta} \dnm \green{Q}}{
            \infer[\unfoc]{\dbox{$\green{P}$} \mid \green{\Gamma_{0}'} \dnm \dbox{$\green{\Gamma_1{\lolli}^+ A}$}}{
              \infer[\lolliR^+]{\green{P} \mid \green{\Gamma_{0}'} \upm \green{\Gamma_1{\lolli}^+ A}}{
                \infer={\green{P} \mid \green{\Gamma_{0}'}, \green{\Gamma_1}\upm \green{A}}{
                \deduce{\green{P} \mid \green{\Delta'}\upm \green{A}}{h'}
                }
              }
            }
            &
            \green{\green{\Gamma_1}{\lolli}^+ A} \mid \green{\Delta} \rfm \green{Q}
          }
        }
      }
    }
    \]
where $h'$ is obtained from $h$ by making all applications of red rules ($\red{\focL}$ and $\red{\focR}$) in $h$ black ($\focL$ and $\focR$).
  \end{enumerate}
\end{proof}

It is possible to show that proofs in the maximally multi-focused calculus are canonical wrt. the equational theory in \Cref{sec:app} on multi-focused derivations. Therefore, by \Cref{thmeq}, they are also canonical wrt. the equational theory in \Cref{fig:circeq} on unfocused derivations. 
\begin{theorem}\label{thm3}
  Functions $\mathsf{max}_\up$ and $\mathsf{untag}_\up$ underlie an isomorphism between the set of proofs of a sequent $S \mid \Gamma \up A$ quotiented by the equivalence relation $\circeq_\up$ and the set of proofs of $\green{S} \mid \green{\Gamma} \upm \green{A}$. % in the maximally multi-focused calculus.
\end{theorem}
We refer the reader to our Agda formalization for details about the proofs.
\begin{corollary}\label{cor}
  Functions $\mathsf{max}_\up\circ \focus$ and $\emb \circ \mathsf{untag}_\up$ underlie an isomorphism between the set of proofs of a sequent $S \mid \Gamma \vdash A$ quotiented by the equivalence relation $\circeq$ and the set of proofs of $\green{S} \mid \green{\Gamma} \upm \green{A}$. % in the maximally multi-focused calculus.
\end{corollary}
\begin{proof}
  By putting together \Cref{thmeq} and \Cref{thm3}.
\end{proof}

%%%  Four proof search phases:
%%%  \[
%%%  \begin{array}{rl}
%%%    \text{Invertible/passivation :} &  S \mid \Gamma \up A \\
%%%    \text{Left-focusing :} &  S \dn \Gamma \mid A \\
%%%    \text{Right-focusing :} &  S \mid \Gamma \dn A \\
%%%    \text{Multi-focusing :} &  S \dn \Gamma \dn A
%%%  \end{array}
%%%  \]
%%%  Sequents can also hold a tag $\ell$, meaning that we are the current goal arose from left focusing, or $r$, meaning that the current goal arose from right focusing. Metavariables $x,y$  denote tags, which can in particular be empty, i.e. not carrying a tag at all. A sequent can have at most one tag, so e.g. $S \mid^x \Gamma \up^y A$ means either $S \mid \Gamma \up A$ (no tags) or $S \mid^\ell \Gamma \up A$ (left tag is on) or $S \mid \Gamma \up^r A$ (right tag is on). In $\ell$-tagged contexts, formulae in context can also have tag $\ell$, corresponding to those formulae appearing in context by means of left invertible rules $\IL$, $\otL$ and passivation after termination of a left focusing phase. Similarly, in $r$-tagged contexts, formulae in context can have tag $r$, which implies that these formulae appeared in context by means of the right invertible rule $\lolliR$ after termination of a right focusing phase. Contexts of the form $\Gamma^{\bcancel{\ell}}$ or $\Gamma^{\bcancel{r}}$ are the same as $\Gamma$ but with all tags removed.
%%%  
%%%   Focused derivations are inductively generated by the following rules:
%%%   \begin{equation}\label{fig:max-multi-focus}\small
%%%   %  \def\arraystretch{2.5}
%%%     \begin{array}{c}
%%%       \multicolumn{1}{l}{\text{\textsc{Invertible/Passivation Phase}}} \\[4pt]
%%%         \infer[\lolliR]{S \mid \Gamma \up^{\r} A \lolli B}{S \mid \Gamma , A^{\r} \up^{\r} B}
%%%       \qquad
%%%   %    \infer[\sw]{S \mid \Gamma \up^{r} P}{S \up \Gamma \mid^{r} P}
%%%   %  \end{displaymath}
%%%       %  \begin{displaymath}
%%%   %    \\[6pt]
%%%       \infer[\otL]{A \ot B \mid^\l \Gamma \up Q}{A \mid^\l  B^{\l} , \Gamma \up Q}
%%%       \qquad
%%%         \infer[\IL]{\I \mid^\l \Gamma \up Q}{- \mid^\l \Gamma \up Q}    
%%%       \qquad
%%%   %    \infer[\sw]{T \up \Gamma \xvdash_{\LI} P}{T \mid \Gamma \xvdash_{\Pass} P}
%%%   %  \end{displaymath}
%%%       %  \begin{displaymath}
%%%       \\[6pt]    
%%%       \infer[\pass_\bullet]{- \mid A^{\bullet} , \Gamma \up^{\bullet} Q }{
%%%         A\mid \Gamma^{\circ} \up Q
%%%       }
%%%       \qquad
%%%       \infer[\pass]{- \mid^{\l} A , \Gamma \up Q }{
%%%         A^\circ \mid^{\l} \Gamma \up Q
%%%       }
%%%       \qquad
%%%           \infer[\foc]{T \mid^{\l} \Gamma \up^{\r} Q}{
%%%         \fbox{$T$}^{\, ?} \mid^\l \Gamma \dn^{\r} \fbox{$Q$}^{\, ?}
%%%       }
%%%   %    \\[6pt]
%%%   %    %
%%%   %    \infer[\focL]{M \mid^{x} \Gamma \up^{y} Q}{
%%%   %      M \dn \Gamma^{\bcancel{\ell}} \mid^{y} Q
%%%   %    }
%%%   %    \qquad
%%%   %    \infer[\focR]{T \mid^{x} \Gamma \up^{y} P}{
%%%   %      T \mid^{x} \Gamma^{\bcancel{r}} \dn P
%%%   %    }
%%%   %    \qquad
%%%   %    \infer[\focLR]{N \mid^{x} \Gamma \up^{y} P}{
%%%   %      N \dn^{x} \Gamma \dn^y P
%%%   %    }
%%%   %  \end{displaymath}
%%%       %  \begin{displaymath}
%%%       \\[9pt]
%%%   %    \hline
%%%       \multicolumn{1}{l}{\text{\textsc{Focusing Phase}}} \\[4pt]
%%%       \infer[\lolliL]{\fbox{$A \lolli B$} \mid^\l \Gamma , \Delta \dn^\r \fbox{$Q$}^{\,?}}{
%%%         - \mid \Gamma^\circ \up A
%%%         &
%%%         \fbox{$B$} \mid^\l \Delta \dn^\r \fbox{$Q$}^{\,?}
%%%       }
%%%       \qquad
%%%       \infer[\lolliL_\bullet]{\fbox{$A \lolli B$} \mid \Gamma , \Delta \dn^\bullet \fbox{$Q$}^{\,?}}{
%%%         - \mid \Gamma^{\circ} \up A
%%%         &
%%%         \fbox{$B$} \mid \Delta^{\circ} \dn \fbox{$Q$}^{\,?}
%%%         &
%%%         \bullet \in \Gamma
%%%       }
%%%   %%    \infer[\lleft^+]{\vec{A} \lolli B \dn \vec{\Gamma} , \Delta \mid^r Q}{
%%%   %%      \{- \mid \Gamma_j^{\bcancel{r}} \up A_j\}_{j>0}
%%%   %%      &
%%%   %%      B \dn \Delta^{\bcancel{r}} \mid Q
%%%   %%      &
%%%   %%      r \in \vec{\Gamma}
%%%       %%    }
%%%           \\[6pt]
%%%   %        \hline
%%%   %    \multicolumn{1}{l}{\text{\textsc{Right-focusing}}} \\
%%%       \infer[\otR]{T \mid^\l \Gamma , \Delta \dn \fbox{$A \ot B$}}{
%%%         T \mid^\l \Gamma \dn \fbox{$A$}
%%%         &
%%%         - \mid \Delta^\circ \up B
%%%       }
%%%       \qquad
%%%       \infer[\otR_\bullet]{T \mid^{\bullet} \Gamma , \Delta \dn \fbox{$A \ot B$}}{
%%%         T \mid \Gamma^{\circ} \dn \fbox{$A$}
%%%         &
%%%         - \mid \Delta^{\circ} \up B
%%%         &
%%%         \bullet \in \Delta
%%%       }
%%%       \\[6pt]
%%%       \infer[\IR]{- \mid ~ \dn \fbox{$\I$}}{}
%%%       \qquad
%%%           \infer[\blurL]{\fbox{$Q$} \mid^\l \Gamma \dn \fbox{$A$}^{\,?}}{
%%%         \dbox{$Q$} \mid^\l \Gamma \dn \fbox{$A$}^{\,?}
%%%         }    
%%%       \qquad
%%%           \infer[\blurR]{\dbox{$T$}^{\,?} \mid \Gamma \dn \fbox{$M$}}{
%%%         \dbox{$T$}^{\,?} \mid \Gamma \dn \dbox{$M$}
%%%       }
%%%       \\[6pt]
%%%       \infer[\ax]{\dbox{$X$} \mid ~ \dn \dbox{$X$}}{}
%%%       \qquad
%%%       \infer[\tagL]{\dbox{$P$} \mid \Gamma \dn A}{
%%%         P \mid^\bullet \Gamma \up A}
%%%       \qquad
%%%       \infer[\tagR]{T \mid \Gamma \dn \dbox{$N$}}{
%%%         T \mid \Gamma \up^\bullet N }
%%%       \qquad
%%%       \infer[\tagM]{\dbox{$P$} \mid \Gamma \dn \dbox{$N$}}{
%%%       P \mid \Gamma \up N}
%%%   %    \quad
%%%   %%    \infer[\tr^+]{T \mid^{\ell} \Gamma , \vec{\Delta} \dn A \ot \vec{B}}{
%%%   %%      T \mid \Gamma^{\bcancel{\ell}} \dn A
%%%   %%      &
%%%   %%      \{ - \mid \Delta_i^{\bcancel{\ell}} \up B_i\}_{i>0}
%%%   %%      &
%%%   %%      \ell \in \vec{\Delta}
%%%   %%    }
%%%   %%    \\[6pt]
%%%   %%    \infer[\lleft\!\tr^+]{\vec{A} \lolli C \dn^{\ell} \vec{\Gamma}, \Lambda, \vec{\Delta} \dn^r D \ot \vec{B}}{
%%%   %%      \{- \mid \Gamma_j^{\bcancel{\ell}\bcancel{r}} \up A_j\}_{j>0} &
%%%   %%      C \mid \Lambda^{\bcancel{\ell}\bcancel{r}} \up D
%%%   %%      &
%%%   %%      \{ - \mid \Delta_i^{\bcancel{\ell}\bcancel{r}} \up B_i\}_{i>0}
%%%   %%      &
%%%   %%      \ell \in \vec{\Delta}
%%%   %%      &
%%%   %%      r \in \vec{\Gamma}
%%%   %%    }
%%%   %    \\[6pt]
%%%   %    \hline
%%%   %    \multicolumn{1}{l}{\text{\textsc{Multi-focusing}}} \\
%%%   %    \infer[\lleft_\M]{A \lolli B \dn^x \Gamma , \Delta \dn^y C}{
%%%   %      ~ \mid \Gamma^{\bcancel{\ell}} \up A
%%%   %      &
%%%   %      B \dn^x \Delta \dn^y C
%%%   %    }
%%%   %    \qquad
%%%   %    \infer[\lleft^r_\M]{A \lolli B \dn^x \Gamma , \Delta \dn^r C}{
%%%   %      ~ \mid \Gamma^{\bcancel{\ell}\bcancel{r}} \up A
%%%   %      &
%%%   %      B \dn^x \Delta^{\bcancel{r}} \dn C
%%%   %      &
%%%   %      r \in \Gamma
%%%   %    }
%%%   %    \\[6pt]
%%%   %    \infer[\tr_\M]{Q \dn^{x} \Gamma , \Delta \dn A \ot B}{
%%%   %      Q \dn^x \Gamma \dn A
%%%   %      &
%%%   %      - \mid \Delta \up B
%%%   %    }
%%%   %    \qquad
%%%   %    \infer[\tr^\ell_\M]{Q \dn^{\ell} \Gamma , \Delta \dn A \ot B}{
%%%   %      Q \dn \Gamma^{\bcancel{\ell}} \dn A
%%%   %      &
%%%   %      - \mid \Delta^{\bcancel{\ell}} \up B
%%%   %      &
%%%   %      \ell \in \Delta
%%%   %    }
%%%   %    \qquad
%%%   %        \infer[\blurLR]{Q \dn \Gamma \dn M}{
%%%   %      Q \mid \Gamma \up M
%%%   %      }
%%%   %    \hspace{4.1pt}
%%%   %  \end{displaymath}
%%%   %  \begin{displaymath}
%%%     \end{array}
%%%   \end{equation}
%%%  %\qquad
%%%  %R = \I,M
%%%  %\]
%%%  %%\niccolo{What about these changes?
%%%  %%
%%%  %%
%%%  %%  - In right-focusing phase, condition $\ell \in \vec{\Delta}$ not always necessary. E.g. try to prove $\I \lolli \I | ~ \up \I \ot \I$
%%%  %%
%%%  %%%  - In multi-focusing phase, replace $R$ by $M$ and add possibility of doing $\IR$
%%%  %%  }
%%%  
%%%  The focused calculus in (\ref{fig:max-multi-focus}) is sound wrt. the sequent calculus in (\ref{fig:seqcalc}). It
%%%  is also complete, which follows from Propositions \ref{prop:adm1}
%%%  and \ref{prop:adm2} below.
%%%  \begin{proposition}\label{prop:adm1}
%%%    The following rules are admissible:
%%%    \[
%%%        \infer[\unitl_\up]{\I \mid \Gamma \up C}{- \mid \Gamma \up C}
%%%      \qquad
%%%      \infer[\tl_\up]{A \ot B \mid\Gamma \up C}{A \mid B , \Gamma \up C}
%%%      \qquad
%%%  %    \infer[\sw]{T \up \Gamma \xvdash_{\LI} P}{T \mid \Gamma \xvdash_{\Pass} P}
%%%  %  \end{displaymath}
%%%      %  \begin{displaymath}
%%%      \infer[\pass_\up]{- \mid A , \Gamma \up C }{
%%%        A\mid \Gamma \up C
%%%      }
%%%      \]
%%%  \end{proposition}
%%%  \begin{proof}
%%%    Induction on the premise of each rule.
%%%  \end{proof}
%%%  
%%%  %%Define the relation $\Gamma\mid A \rightsquigarrow_{\mathsf{R}} \Delta \mid B$ via the rules:
%%%  %%\[
%%%  %%\infer{\Gamma\mid A \rightsquigarrow_{\mathsf{R}} \Gamma\mid A}{}
%%%  %%\qquad
%%%  %%\infer{\Gamma\mid A \rightsquigarrow_{\mathsf{R}} \Delta \mid B \lolli C}{
%%%  %%  \Gamma\mid A \rightsquigarrow_{\mathsf{R}} \Delta,B \mid C
%%%  %%}
%%%  %%\]
%%%  \begin{lemma}\label{lem:otR}
%%%    The following rules are admissible:
%%%    \[
%%%  %  \infer[\tr_{\up Q}^+]{S \mid^{\ell} \Gamma , \vec{\Delta} \up Q \ot \vec{B}}{
%%%  %      S \mid^{\ell} \Gamma \up Q
%%%  %      &
%%%  %      \{ - \mid \Delta_i \up B_i\}_{i>0}
%%%  %  }
%%%  %  \qquad
%%%    \infer[\tr_{\up P}^+]{S \mid^x \Gamma , \vec{\Delta} \up P \ot \vec{B}}{
%%%        \deduce{S \mid^x \Gamma \up P}{f}
%%%        &
%%%        \deduce{\{ - \mid \Delta_i \up B_i\}_{i>0}}{g_i}
%%%  %      & \Gamma' \not= -
%%%    }
%%%    \qquad
%%%    \infer[\tr_{\up N}^+]{S \mid \Gamma , \vec{\Delta} \up (\Gamma' \lolli Q) \ot \vec{B}}{
%%%        \deduce{S \mid \Gamma,\Gamma' \up Q}{f}
%%%        &
%%%        \deduce{\{ - \mid \Delta_i \up B_i\}_{i>0}}{g_i}
%%%  %      & \Gamma' \mid Q \rightsquigarrow_{\mathsf{R}} ~ \mid M
%%%    }
%%%    \]
%%%    %In $\tr_{\up P}^+$ we additionally require that, when $S = T$ and
%%%    %$\ell = \bullet$ then $\bullet \in \Gamma$.
%%%  \end{lemma}
%%%  \begin{proof}[Proof of $\tr_{\up P}^+$]%\renewcommand{\qedsymbol}{}
%%%  %  We only discuss $\tr_\up^+$, the proof of $\lleft_{\up}^+$ is
%%%  %  analogous (kinda specular).
%%%    By induction on $f$, the challenging cases are the focusing rules.
%%%  %  \begin{itemize}
%%%  \\\fbox{Case $f = \focL(f')$} with $f' : M \dn \Gamma \mid P$ and 
%%%  %\\    If $f' = \ax$, so $M = Q = X$ and $\Gamma = -$,
%%%  %then 
%%%  %    \[\small
%%%  %    \proofbox{
%%%  %      \infer[\tr_{\up P}^+]{X \mid \vec{\Delta} \up X \ot \vec{B}}{
%%%  %        \infer[\focL]{X \mid ~ \up X}{
%%%  %          \infer[\ax]{X \dn ~ \mid X}{}
%%%  %      }
%%%  %      &
%%%  %      \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}
%%%  %      }
%%%  %    }
%%%  %    =
%%%  %    \proofbox{
%%%  %      \infer[\focR]{X \mid \vec{\Delta} \up X \ot \vec{B}}{
%%%  %        \infer[\otR^+]{X \mid \vec{\Delta} \dn X \ot \vec{B}}{
%%%  %          \infer[\ax]{X \mid ~ \dn X}{} &
%%%  %      &
%%%  %      \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}          
%%%  %        }
%%%  %      }
%%%  %    }
%%%  %    \]
%%%  %    \\If $f' = \lolliL(\{f_j\},\ax)$ then
%%%  %    \[\small
%%%  %    \proofbox{
%%%  %      \infer[\tr_{\up P}^+]{\vec{A} \lolli X \mid \vec{\Gamma},\vec{\Delta} \up X \ot \vec{B}}{
%%%  %        \infer[\focL]{\vec{A} \lolli X \mid \vec{\Gamma} \up X}{
%%%  %          \infer[\lolliL^+]{\vec{A} \lolli X \dn \vec{\Gamma} \mid X}{
%%%  %          \deduce{\{ - \mid \Gamma_j \up A_j\}}{f_j}
%%%  %          &
%%%  %          \infer[\ax]{X \dn ~ \mid X}{}
%%%  %          }
%%%  %        }
%%%  %      &
%%%  %      \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}
%%%  %      }
%%%  %    }
%%%  %    =
%%%  %    \proofbox{
%%%  %      \infer[\focLR]{\vec{A} \lolli X \mid \vec{\Gamma},\vec{\Delta} \up X \ot \vec{B}}{
%%%  %        \infer[\lolliL\otR^+]{\vec{A} \lolli X \dn \vec{\Gamma},\vec{\Delta} \dn X \ot \vec{B}}{
%%%  %          \deduce{\{ - \mid \Gamma_j \up A_j\}}{f_j}
%%%  %          &
%%%  %          \infer[\blurLR]{X \dn ~ \dn X}{
%%%  %            \infer[\focL]{X \mid ~ \up X}{
%%%  %              \infer[\ax]{X \dn ~ \mid X}{}
%%%  %            }
%%%  %          }          
%%%  %          &
%%%  %          \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}
%%%  %        }
%%%  %      }
%%%  %    }
%%%  %    \]
%%%      $f' = \lolliL^+(\{f_j\},\blurL(h))$:
%%%      \[\footnotesize%\small
%%%      \proofbox{
%%%        \infer[\tr_{\up P}^+]{\vec{A} \lolli P' \mid^x \vec{\Gamma},\Lambda,\vec{\Delta} \up P \ot \vec{B}}{
%%%          \infer[\focL]{\vec{A} \lolli P' \mid^x \vec{\Gamma},\Lambda \up P}{
%%%            \infer[\lolliL^+]{\vec{A} \lolli P' \dn \vec{\Gamma},\Lambda \mid P}{
%%%            \deduce{\{ - \mid \Gamma_j \up A_j\}}{f_j}
%%%            &
%%%            \infer[\blurL]{P' \dn \Lambda \mid P}{
%%%              \deduce{P' \mid^\ell \Lambda \up P}{h}
%%%            }
%%%            }
%%%          }
%%%        &
%%%        \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}
%%%        }
%%%      }
%%%      \hspace{-.6cm}
%%%      =
%%%      \proofbox{
%%%        \infer[\focL]{\vec{A} \lolli P' \mid^x \vec{\Gamma},\Lambda,\vec{\Delta} \up P \ot \vec{B}}{
%%%          \infer[\lolliL^+]{\vec{A} \lolli P' \dn \vec{\Gamma}, \Lambda, \vec{\Delta} \mid P \ot \vec{B}}{
%%%            \deduce{\{ - \mid \Gamma_j \up A_j\}}{f_j}
%%%            &
%%%            \infer[\blurL]{P' \dn \Lambda, \vec{\Delta} \mid P \ot \vec{B}}{
%%%              \infer[\otR^+_{\up P}]{P' \mid^\ell \Lambda, \vec{\Delta} \up P \ot \vec{B}}{
%%%                \deduce{P' \mid^\ell \Lambda \up P}{h}
%%%        &
%%%        \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}
%%%          }
%%%        }
%%%          }
%%%        }
%%%      }
%%%      \]
%%%      \fbox{Case $f = \focLR(f')$} with $f' : N \dn \Gamma \dn P$ and $f' = \lolliL\otR^+(\{f_j\},\blurLR(k),\{h_l\})$:
%%%      \[\footnotesize \hspace{-2cm}
%%%      \proofbox{
%%%        \infer[\tr^+_{\up P}]{\vec{A} \lolli Q \mid^x \vec{\Gamma},\Lambda,\vec{\Omega},\vec{\Delta} \up (M \ot \vec{C}) \ot \vec{B}}{
%%%          \infer[\focLR]{\vec{A} \lolli Q \mid^x \vec{\Gamma}, \Lambda, \vec{\Omega}, \up M \ot \vec{C}}{
%%%            \infer[\lolliL\otR^+]{\vec{A} \lolli Q \dn^x \vec{\Gamma}, \Lambda, \vec{\Omega}, \dn M \ot \vec{C}}{
%%%              \deduce{\{ - \mid \Gamma_j^{\bcancel{\ell}} \up A_j\}}{f_j}
%%%              &
%%%              \infer[\blurLR]{Q \dn \Lambda^{\bcancel{\ell}} \dn M}{
%%%                \deduce{Q \mid \Lambda^{\bcancel{\ell}} \up M}{k}
%%%              }
%%%              &
%%%              \deduce{\{ - \mid \Omega_l^{\bcancel{\ell}} \up C_l\}}{h_l}
%%%              &
%%%              x \in \vec{\Omega}
%%%            }
%%%        }
%%%            \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}            
%%%        }
%%%      }
%%%      \]
%%%      \[\footnotesize \hspace{2cm}
%%%      =
%%%      \proofbox{
%%%        \infer[\focLR]{\vec{A} \lolli Q \mid^x \vec{\Gamma}, \Lambda, \vec{\Omega}, \vec{\Delta} \up (M \ot \vec{C}) \ot \vec{B}}{
%%%          \infer[\lolliL\otR^+]{\vec{A} \lolli Q \dn^x \vec{\Gamma}, \Lambda, \vec{\Omega}, \vec{\Delta} \dn (M \ot \vec{C}) \ot \vec{B}}{
%%%              \deduce{\{ - \mid \Gamma_j^{\bcancel{\ell}} \up A_j\}}{f_j}
%%%              &
%%%              \infer[\blurLR]{Q \dn \Lambda^{\bcancel{\ell}} \dn M}{
%%%                \deduce{Q \mid \Lambda^{\bcancel{\ell}} \up M}{k}
%%%              }
%%%              &
%%%              \deduce{\{ - \mid \Omega_l^{\bcancel{\ell}} \up C_l\}}{h_l} \cup
%%%              \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}
%%%              &
%%%              x \in \vec{\Omega}
%%%          }
%%%        }
%%%      }
%%%      \]
%%%      \fbox{Case $f = \focR(f')$} with $f' : T \mid \Gamma \dn P$:
%%%      \[\footnotesize
%%%      \proofbox{
%%%        \infer[\tr_{\up P}^+]{T \mid^x \Gamma , \vec{\Delta} \up P \ot \vec{B}}{
%%%          \infer[\focR]{T \mid^x \Gamma \up P}{
%%%            \deduce{T \mid^x \Gamma \dn P}{f'}
%%%          }
%%%          &
%%%          \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}
%%%        }
%%%      }
%%%      =
%%%      \proofbox{
%%%        \infer[\focR]{T \mid^x \Gamma , \vec{\Delta} \up P \ot \vec{B}}{
%%%          \infer[\otR^+]{T \mid^x \Gamma , \vec{\Delta} \dn P \ot \vec{B}}{
%%%            \deduce{T \mid^x \Gamma \dn P}{f'}
%%%            &
%%%            \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}
%%%          }
%%%        }
%%%      }
%%%      \]
%%%  \end{proof}
%%%  \begin{proof}[Proof of $\tr_{\up N}^+$]
%%%  %  We only discuss $\tr_\up^+$, the proof of $\lleft_{\up}^+$ is
%%%  %  analogous (kinda specular).
%%%    By induction on $f$, the challenging cases
%%%    are $\pass$ and the focusing rules.
%%%    \\
%%%    \fbox{Case $f = \pass(f')$} with $f' : C \mid \Omega \up Q$ and
%%%    $C,\Omega = \Gamma,\Gamma'$:
%%%    \\If $A'$ is in the head of $\Gamma$,
%%%      then we simply permute $\tr^+_\up$ with $\pass$. If $\Gamma = -$,
%%%      then
%%%      \[\footnotesize
%%%      \proofbox{
%%%        \infer[\tr_{\up N}^+]{- \mid \vec{\Delta} \up ((C, \Omega) \lolli Q) \ot \vec{B}}{
%%%        \infer[\pass]{- \mid C,\Omega \up Q}{
%%%          \deduce{C \mid \Omega \up Q}{f'}
%%%        }
%%%        &
%%%        \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}
%%%        }
%%%      }
%%%      =
%%%      \proofbox{
%%%        \infer[\focR]{- \mid \vec{\Delta} \up ((C ,\Omega) \lolli Q) \ot \vec{B}}{
%%%          \infer[\tr^+]{- \mid \vec{\Delta} \dn ((C,\Omega) \lolli Q) \ot \vec{B}}{
%%%            \infer[\blurR]{- \mid ~ \dn (C,\Omega) \lolli Q}{
%%%              \infer[\lolliR^+]{- \mid ~ \up^r (C,\Omega) \lolli Q}{
%%%                \infer[\pass]{ - \mid C^r,\Omega^r \up^r Q}{
%%%                  \deduce{C \mid \Omega \up Q}{f'}
%%%                }
%%%              }
%%%            }
%%%            &
%%%            \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}
%%%        }
%%%        }
%%%      }
%%%      \]
%%%      \fbox{Case $f = \focL(f')$} with $f' : M' \dn \Gamma,\Gamma' \mid Q$:
%%%  \\    If $f' = \ax$, so $M' = Q = X$ and $\Gamma = \Gamma' = -$,
%%%  then 
%%%     \[\footnotesize
%%%     \proofbox{
%%%       \infer[\tr_{\up N}^+]{X \mid \vec{\Delta} \up X \ot \vec{B}}{
%%%         \infer[\focL]{X \mid ~ \up X}{
%%%           \infer[\ax]{X \dn ~ \mid X}{}
%%%       }
%%%       &
%%%       \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}
%%%       }
%%%     }
%%%     =
%%%     \proofbox{
%%%       \infer[\focR]{X \mid \vec{\Delta} \up X \ot \vec{B}}{
%%%         \infer[\otR^+]{X \mid \vec{\Delta} \dn X \ot \vec{B}}{
%%%           \infer[\blurR]{X \mid ~ \dn X}{
%%%             \infer[\focL]{X \mid ~ \up^r X}{
%%%               \infer[\ax]{X \dn ~ \up^r X}{}
%%%             }
%%%           } &
%%%       &
%%%       \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}          
%%%         }
%%%       }
%%%     }
%%%     \]
%%%      If $f' = \lolliL^+(\{f_j\},h)$ and the $f_j$ do not use resources from $\Gamma'$:
%%%      \[\footnotesize
%%%      \proofbox{
%%%        \infer[\tr_{\up N}^+]{\vec{A} \lolli Q' \mid \vec{\Gamma},\Lambda,\vec{\Delta} \up M \ot \vec{B}}{
%%%          \infer[\focL]{\vec{A} \lolli Q' \mid \vec{\Gamma},\Lambda,\Gamma' \up Q}{
%%%            \infer[\lolliL^+]{\vec{A} \lolli Q' \dn \vec{\Gamma},\Lambda,\Gamma' \mid Q}{
%%%            \deduce{\{ - \mid \Gamma_j \up A_j\}}{f_j}
%%%            &
%%%            \deduce{Q' \dn \Lambda,\Gamma' \mid Q}{h}
%%%            }
%%%          }
%%%        &
%%%        \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}
%%%        }
%%%      }
%%%      \hspace{-1.257 cm}
%%%      =
%%%      \proofbox{
%%%        \infer[\focLR]{\vec{A} \lolli Q' \mid \vec{\Gamma},\Lambda,\vec{\Delta} \up M \ot \vec{B}}{
%%%          \infer[\lolliL\otR^+]{\vec{A} \lolli Q' \dn \vec{\Gamma}, \Lambda, \vec{\Delta} \dn M \ot \vec{B}}{
%%%            \deduce{\{ - \mid \Gamma_j \up A_j\}}{f_j}
%%%            &
%%%            \infer[\lolliR^{\star}]{Q' \mid \Lambda \up M}{
%%%              \deduce{Q' \mid \Lambda,\Gamma' \up Q}{h'}
%%%            }
%%%            &
%%%            \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}
%%%          }
%%%        }
%%%      }
%%%      \]
%%%      where $h'$ is derivable from $h$.
%%%      \\If $f' = \lolliL^+(\{f_j\},h)$ and the $f_j$ do use resources from $\Gamma'$, so $\Gamma = \vec{\Gamma_0}$ and $\Gamma' = \vec{\Gamma_1},\Lambda$ for $\vec{\Gamma_1} \not= -$:
%%%      \[\footnotesize
%%%      \proofbox{
%%%        \infer[\tr_{\up N}^+]{\vec{A} \lolli Q' \mid \vec{\Gamma_0},\vec{\Delta} \up M \ot \vec{B}}{
%%%          \infer[\focL]{\vec{A} \lolli Q' \mid \vec{\Gamma_0},\vec{\Gamma_1},\Lambda \up Q}{
%%%            \infer[\lolliL^+]{\vec{A} \lolli Q' \dn \vec{\Gamma_0},\vec{\Gamma_1},\Lambda \mid Q}{
%%%            \deduce{\{ - \mid \Gamma_j \up A_j\}}{f_j}
%%%            &
%%%            \deduce{Q' \dn \Lambda \mid Q}{h}
%%%            }
%%%          }
%%%        &
%%%        \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}
%%%        }
%%%      }
%%%      \hspace{-.6cm}
%%%      =
%%%     \proofbox{
%%%       \infer[\focR]{\vec{A} \lolli Q' \mid \vec{\Gamma_0},\vec{\Delta} \up M \ot \vec{B}}{
%%%         \infer[\otR^+]{\vec{A} \lolli Q' \mid \vec{\Gamma_0},\vec{\Delta} \dn M \ot \vec{B}}{
%%%           \infer[\blurR]{\vec{A} \lolli Q' \mid \vec{\Gamma_0} \dn M}{
%%%             \infer[\lolliR^+]{\vec{A} \lolli Q' \mid \vec{\Gamma_0} \up^r M}{
%%%               \infer[\focL]{\vec{A} \lolli Q' \mid \vec{\Gamma_0}, \vec{\Gamma_1}^r,\Lambda^r \up^r Q}{
%%%                 \infer[\lolliL^+]{\vec{A} \lolli Q' \dn \vec{\Gamma_0}, \vec{\Gamma_1}^r, \Lambda^r \mid^r Q}{
%%%                   \deduce{\{ - \mid \Gamma_j \up A_j\}}{f_j}
%%%                   &
%%%                   \deduce{Q' \dn \Lambda \mid Q
%%%                 }{h}
%%%               }
%%%             }
%%%           }
%%%         }
%%%           &
%%%           \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}
%%%       }
%%%       }
%%%     }
%%%      \]
%%%  %    \\If $f' = \lolliL(\{f_j\},\ax)$ then
%%%  %    \[\small
%%%  %    \proofbox{
%%%  %      \infer[\tr_{\up P}^+]{\vec{A} \lolli X \mid \vec{\Gamma},\vec{\Delta} \up X \ot \vec{B}}{
%%%  %        \infer[\focL]{\vec{A} \lolli X \mid \vec{\Gamma} \up X}{
%%%  %          \infer[\lolliL^+]{\vec{A} \lolli X \dn \vec{\Gamma} \mid X}{
%%%  %          \deduce{\{ - \mid \Gamma_j \up A_j\}}{f_j}
%%%  %          &
%%%  %          \infer[\ax]{X \dn ~ \mid X}{}
%%%  %          }
%%%  %        }
%%%  %      &
%%%  %      \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}
%%%  %      }
%%%  %    }
%%%  %    =
%%%  %    \proofbox{
%%%  %      \infer[\focLR]{\vec{A} \lolli X \mid \vec{\Gamma},\vec{\Delta} \up X \ot \vec{B}}{
%%%  %        \infer[\lolliL\otR^+]{\vec{A} \lolli X \dn \vec{\Gamma},\vec{\Delta} \dn X \ot \vec{B}}{
%%%  %          \deduce{\{ - \mid \Gamma_j \up A_j\}}{f_j}
%%%  %          &
%%%  %          \infer[\blurLR]{X \dn ~ \dn X}{
%%%  %            \infer[\focL]{X \mid ~ \up X}{
%%%  %              \infer[\ax]{X \dn ~ \mid X}{}
%%%  %            }
%%%  %          }          
%%%  %          &
%%%  %          \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}
%%%  %        }
%%%  %      }
%%%  %    }
%%%  %    \]
%%%      \fbox{Case $f = \focLR(f')$} with $f' : N \dn \Gamma,\Gamma' \dn P$.
%%%      \\If $f' = \lolliL\otR^+(\{f_j\},\blurLR(k),\{h_l\})$ and the $f_i$ do not use resources in $\Gamma'$, so $\Gamma,\Gamma' = \vec{\Gamma},\Lambda,\vec{\Omega}$ and $\Gamma = \vec{\Gamma},\Lambda'$:
%%%      \[\footnotesize \hspace{-2cm}
%%%      \proofbox{
%%%        \infer[\tr^+_{\up N}]{\vec{A} \lolli Q \mid \Gamma,\vec{\Delta} \up M \ot \vec{B}}{
%%%          \infer[\focLR]{\vec{A} \lolli Q \mid \vec{\Gamma}, \Lambda, \vec{\Omega}, \up M' \ot \vec{C}}{
%%%            \infer[\lolliL\otR^+]{\vec{A} \lolli Q \dn \vec{\Gamma}, \Lambda,\vec{\Omega}, \dn M' \ot \vec{C}}{
%%%              \deduce{\{ - \mid \Gamma_j\up A_j\}}{f_j}
%%%              &
%%%              \infer[\blurLR]{Q \dn \Lambda \dn M'}{
%%%                \deduce{Q \mid \Lambda \up M'}{k}
%%%              }
%%%              &
%%%              \deduce{\{ - \mid \Omega_l \up C_l\}}{h_l}
%%%            }
%%%        }
%%%            \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}            
%%%        }
%%%      }
%%%      \]
%%%      \[\footnotesize \hspace{2cm}
%%%      =
%%%      \proofbox{
%%%        \infer[\focLR]{\vec{A} \lolli Q \mid \Gamma, \vec{\Delta} \up M \ot \vec{B}}{
%%%          \infer[\lolliL\otR^+]{\vec{A} \lolli Q \dn \Gamma,\vec{\Delta} \dn M \ot \vec{B}}{
%%%              \deduce{\{ - \mid \Gamma_j \up A_j\}}{f_j}
%%%              &
%%%              \infer[\blurLR]{Q \dn \Lambda' \dn M}{
%%%                \infer[\lolliR^+]{Q \mid \Lambda' \up M}{
%%%                  \infer[\tr^+_{\up N}]{Q \mid \Lambda,\vec{\Omega} \up M' \ot \vec{C}}{
%%%                    \deduce{Q \mid \Lambda \up M'}{k}           
%%%                    &
%%%                    \deduce{\{ - \mid \Omega_l \up C_l\}}{h_l}
%%%                  }
%%%                }
%%%              }
%%%              &
%%%              \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}
%%%          }
%%%        }
%%%      }
%%%      \]
%%%      If $f' = \lolliL\otR^+(\{f_j\},\blurLR(k),\{h_l\})$ and the $f_i$ use resources in $\Gamma'$, so $\Gamma = \vec{\Gamma'}$ and $\Gamma' = \vec{\Gamma_1},\Lambda,\vec{\Omega}$ for $\vec{\Gamma_1} \not= -$:
%%%      \[\footnotesize \hspace{-2cm}
%%%      \proofbox{
%%%        \infer[\tr^+_{\up N}]{\vec{A} \lolli Q \mid \vec{\Gamma_0},\vec{\Delta} \up M \ot \vec{B}}{
%%%          \infer[\focLR]{\vec{A} \lolli Q \mid \vec{\Gamma_0},\vec{\Gamma_1}, \Lambda, \vec{\Omega}, \up M' \ot \vec{C}}{
%%%            \infer[\lolliL\otR^+]{\vec{A} \lolli Q \dn \vec{\Gamma_0}, \vec{\Gamma_1}, \Lambda, \vec{\Omega}, \dn M' \ot \vec{C}}{
%%%              \deduce{\{ - \mid \Gamma_j\up A_j\}}{f_j}
%%%              &
%%%              \infer[\blurLR]{Q \dn \Lambda \dn M'}{
%%%                \deduce{Q \mid \Lambda \up M'}{k}
%%%              }
%%%              &
%%%              \deduce{\{ - \mid \Omega_l \up C_l\}}{h_l}
%%%            }
%%%        }
%%%            \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}            
%%%        }
%%%      }
%%%      \]
%%%      \[\footnotesize \hspace{2cm}
%%%      =
%%%      \proofbox{
%%%        \infer[\focR]{\vec{A} \lolli Q \mid \vec{\Gamma_0},\vec{\Delta} \up M \ot \vec{B}}{
%%%          \infer[\otR^+]{\vec{A} \lolli Q \mid \vec{\Gamma_0},\vec{\Delta} \dn M \ot \vec{B}}{
%%%            \infer[\blurR]{\vec{A} \lolli Q \mid \vec{\Gamma_0} \dn M}{
%%%              \infer[\lolliR^+]{\vec{A} \lolli Q \mid \vec{\Gamma_0} \up^r M}{
%%%                \infer[\focLR]{\vec{A} \lolli Q \mid \vec{\Gamma_0}, \vec{\Gamma_1}^r, \Lambda^r, \vec{\Omega}^r \up^r M' \ot \vec{C}}{
%%%                  \infer[\lolliL\otR^+]{\vec{A} \lolli Q \dn \vec{\Gamma_0}, \vec{\Gamma_1}^r, \Lambda^r, \vec{\Omega}^r \dn^r M' \ot \vec{C}}{
%%%                    \deduce{\{ - \mid \Gamma_j\up A_j\}}{f_j}
%%%                    &
%%%                    \infer[\blurLR]{Q \dn \Lambda \dn M'}{
%%%                      \deduce{Q \mid \Lambda \up M'}{k}
%%%                    }
%%%                    &
%%%                    \deduce{\{ - \mid \Omega_l \up C_l\}}{h_l}
%%%                  }
%%%                }
%%%              }
%%%            }
%%%            &
%%%            \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}            
%%%          }
%%%        }
%%%      }
%%%      \]
%%%      \fbox{Case $f = \focR(f')$} with $f' : T \mid \Gamma,\Gamma' \dn P$:
%%%      \[\footnotesize
%%%      \proofbox{
%%%        \infer[\tr_{\up P}^+]{T \mid \Gamma , \vec{\Delta} \up M \ot \vec{B}}{
%%%          \infer[\focR]{T \mid \Gamma,\Gamma' \up P}{
%%%            \deduce{T \mid \Gamma,\Gamma' \dn P}{f'}
%%%          }
%%%          &
%%%          \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}
%%%        }
%%%      }
%%%      =
%%%      \proofbox{
%%%        \infer[\focR]{T \mid \Gamma , \vec{\Delta} \up M \ot \vec{B}}{
%%%          \infer[\otR^+]{T \mid \Gamma , \vec{\Delta} \dn M \ot \vec{B}}{
%%%            \infer[\blurR]{T \mid \Gamma \dn M}{
%%%              \infer[\lolliR^+]{T \mid \Gamma \up^r P}{
%%%                \infer[\focR]{T \mid \Gamma,\Gamma'^r \up^r P}{
%%%                  \deduce{T \mid \Gamma,\Gamma' \dn P}{f'}
%%%                }
%%%              }
%%%            }
%%%            &
%%%            \deduce{\{ - \mid \Delta_i \up B_i\}}{g_i}
%%%          }
%%%        }
%%%      }
%%%      \]
%%%  \end{proof}
%%%  
%%%  \begin{proposition}\label{prop:adm2}
%%%    The following rules are admissible:
%%%    \[
%%%  %  \infer[\tr_{\up Q}^+]{S \mid^{\ell} \Gamma , \vec{\Delta} \up Q \ot \vec{B}}{
%%%  %      S \mid^{\ell} \Gamma \up Q
%%%  %      &
%%%  %      \{ - \mid \Delta_i \up B_i\}_{i>0}
%%%  %  }
%%%  %  \qquad
%%%    \infer[\tr_{\up}]{S \mid \Gamma , \Delta \up A \ot B}{
%%%        S \mid \Gamma \up A
%%%        &
%%%        - \mid \Delta \up B
%%%  %      & \Gamma' \not= -
%%%    }
%%%    \qquad
%%%     \infer[\lleft_{\up}]{A \lolli B \mid \Gamma , \Delta \up C}{
%%%       - \mid \Gamma \up A
%%%       &
%%%       B \mid \Delta \up C
%%%     }    
%%%     \qquad
%%%     \infer[\ax_\up]{A \mid ~ \up A}{}
%%%     \]
%%%  \end{proposition}
%%%  \begin{proof}
%%%  $\tr_\up$ can be proved by case analysis on $A$ using Lemma~\ref{lem:otR}. One can prove a lemma similar (in a way ``dual'') to Lemma~\ref{lem:otR} but involving $\lolliL$ instead of $\otR$, which allows to prove $\lleft_{\up}$. 
%%%  \end{proof}
%%%  
%%%  Putting together Propositions \ref{prop:adm1} and \ref{prop:adm2}, it is possible to construct a function $\focus: S \mid \Gamma\vdash A\to S \mid \Gamma \up A$ sending each generating rule in (\ref{fig:seqcalc}) to its admissible counterpart (with subscript $\up$) in the focused calculus.
%%%  
%%%  Moreover, the function $\focus$ sends $\circeq$-equivalent derivations to equal derivations, i.e. $f \circeq g$ implies $\focus(f) = \focus(g)$.


%\section{Comparison with Other Normal Forms}\label{sec:compare}

%\vspace{-.5cm}
\section{Conclusions}\label{sec:conclusions}

\SkNMILL\ is a relatively weak logic, low in the substructural hierarchy and with a restricted selection of logical connectives. Nevertheless, its simplicity allows to properly investigate complex proof-theoretic procedure such as maximal multi-focusing, which can be subsequently extended to sequent calculi for richer logics. Porting the technique to extensions of \SkNMILL\ with other structural laws, such as full associativity/unitality (recovering the Lambek calculus without left residual) or exchange (as in the sequent calculus of symmetric skew monoidal categories \cite{veltri:coherence:2021}), should be relatively straightforward. Extensions with additive connectives will make things more complicated. To this end, it would be interesting to study semantic approaches to maximal multi-focusing, akin to normalization-by-evaluation \cite{ADHS:noretl,NbELambek} or (proof-relevant) semantic cut elimination \cite{Okada99}.
%, to try to alleviate the complexities of dealing with these extensions.

Uustalu et al. \cite{UVW:protsn} define a normalization procedure for \SkNMILL\ using tags, which is also inspired by focusing. Their canonical derivations arise as normal forms of the confluent and strongly normalizing rewriting system obtained by orienting the equations in \Cref{fig:circeq} from left to right. This means that, during root-first proof search, invertible rules are again applied first, but the application of non-invertible rules $\pass$ and $\lolliL$ is prioritized over $\otR$. Moreover, focus is released after the application of a non-invertible rule and the asynchronous phase is immediately resumed. Maximal multi-focusing, on the other hand, is unbiased with respect to the application of non-invertible rules. We plan to further investigate the relationship between the normal forms of the two normalization strategies, for \SkNMILL\ and other substructural logics.

%One important objective of this project is the formalization of the maximal multi-focusing calculus and the proof of its correctness in the Agda proof assistant. We have started this investigation already, and in fact Agda guided our development in the definition of the normalization functions $\focus$ and $\mathsf{maxfocus}$ in \Cref{thm,thm2}. Nevertheless, proving that $\mathsf{maxfocus}$ defines an isomorphism in the sense of \Cref{thm2} has only been checked on pen and paper and the formal Agda proof is still work in progress. We will give an in-detail report on the Agda formalization in an extended version of this paper.

\bibliographystyle{splncs04}
\bibliography{wollic23}

\appendix
\begin{landscape}
\section{Equivalence of Derivations in the Multi-Focused Sequent Calculus}
\label{sec:app}
  
\[
\begin{array}{rcl}
\proofbox{
  \infer[\focL]{T \mid \Gamma,\Delta,\Lambda \dn Q}{
    \deduce{T \mid \Gamma \lf Q'}{h} &
    \infer[\focR]{\dbox{$Q'$} \mid \Delta,\Lambda \dn Q}{
      \deduce{\dbox{$Q'$} \mid \Delta \dn \dbox{$M$}}{f} &
      \deduce{M \mid \Lambda \rf Q}{k}
    }
  }
}
& \circeq_\dn &
\proofbox{
  \infer[\focR]{T \mid \Gamma,\Delta,\Lambda \dn Q}{    
    \infer[\focL]{T \mid \Gamma,\Delta \dn \dbox{$M$}}{
      \deduce{T \mid \Gamma \lf Q'}{h} &
      \deduce{\dbox{$Q'$} \mid \Delta \dn \dbox{$M$}}{f}      
    }
    &
    \deduce{M \mid \Lambda \rf Q}{k}
  }
}
\\[6pt]
\proofbox{
  \infer[\unfoc]{T \mid \Gamma,\Delta \dn \dbox{$\Lambda \lolli^+ Q$}}{
    \infer[\lolliR^+]{T \mid \Gamma,\Delta \up \Lambda \lolli^+ Q}{
      \infer[\foc]{T \mid \Gamma,\Delta,\Lambda \up Q}{
        \infer[\focL]{T \mid \Gamma , \Delta,\Lambda \dn Q}{
          \deduce{T \mid \Gamma \lf P}{h} &
          \infer[\unfoc]{\dbox{$P$} \mid \Delta,\Lambda \dn Q}{
            \deduce{P \mid \Delta,\Lambda \up Q}{f}
          }
        }
      }
    }
  }
}
& \circeq_\dn &
\proofbox{
  \infer[\focL]{T \mid \Gamma,\Delta \dn \dbox{$\Lambda \lolli^+ Q$}}{
    \deduce{T \mid \Gamma \lf P}{h} &
    \infer[\unfoc]{\dbox{$P$} \mid \Delta \dn \dbox{$\Lambda \lolli^+ Q$}}{
      \infer[\lolliR^+]{P \mid \Delta \up \Lambda \lolli^+ Q}{
        \deduce{P \mid \Delta,\Lambda \up Q}{f}
      }
    }
  }
}
\\[6pt]
\proofbox{
  \infer[\unfoc]{T \mid \Gamma,\Delta \dn \dbox{$\Lambda \lolli^+ Q$}}{
    \infer[\lolliR^+]{T \mid \Gamma,\Delta \up \Lambda \lolli^+ Q}{
      \infer[\foc]{T \mid \Gamma,\Delta,\Lambda \up Q}{
        \infer[\focL]{T \mid \Gamma , \Delta,\Lambda \dn Q}{
          \deduce{T \mid \Gamma \lf X}{h} &
          \deduce{\dbox{$X$} \mid \Delta,\Lambda \dn Q}{f}
        }
      }
    }
  }
}  
& \circeq_\dn &
\proofbox{
  \infer[\focL]{T \mid \Gamma,\Delta \dn \dbox{$\Lambda \lolli^+ Q$}}{
    \deduce{T \mid \Gamma \lf X}{h} &
    \infer[\unfoc]{\dbox{$X$} \mid \Delta \dn \dbox{$\Lambda \lolli^+ Q$}}{
      \infer[\lolliR^+]{X \mid \Delta \up \Lambda \lolli^+ Q}{
        \infer[\foc]{X \mid \Delta,\Lambda \up Q}{
          \infer[\focL]{X \mid \Delta,\Lambda \dn Q}{
            \infer[\blurL]{X \mid ~ \lf X}{} &
            \deduce{\dbox{$X$} \mid \Delta,\Lambda \dn Q}{f}
          }
        }
      }
    }
  }
}
\end{array}
\]
\[
%\small
\begin{array}{rcl}
\proofbox{
  \infer[\unfoc]{\dbox{$P$} \mid \Delta,\Lambda \dn Q}{
    \infer[\runL]{P \mid \Delta,\Lambda \up Q}{
      \deduce{\L(T\mid\Gamma;P)}{\ell} &
      \infer[\foc]{T \mid \Gamma,\Delta,\Lambda \up Q}{
        \infer[\focR]{T \mid \Gamma,\Delta,\Lambda \dn Q}{
          \infer[\unfoc]{T \mid \Gamma,\Delta \dn \dbox{$N$}}{
            \deduce{T \mid \Gamma,\Delta \up N}{f}
          }
          &
          \deduce{N \mid \Lambda \rf Q}{h}
        }
      }
    }
  }
}
& \circeq_\dn &
\proofbox{
  \infer[\focR]{\dbox{$P$} \mid \Delta,\Lambda \dn Q}{
    \infer[\unfoc]{\dbox{$P$} \mid \Delta \dn \dbox{$N$}}{
      \infer[\runL]{P \mid \Delta \up N}{
        \deduce{\L(T\mid\Gamma;P)}{\ell} &
        \deduce{T \mid \Gamma,\Delta \up N}{f}
      }
    }
    &
    \deduce{N \mid \Lambda \rf Q}{h}
  }
}
\\[6pt]
\proofbox{
  \infer[\unfoc]{\dbox{$P$} \mid \Delta,\Lambda \dn Q}{
    \infer[\runL]{P \mid \Delta,\Lambda \up Q}{
      \deduce{\L(T\mid\Gamma;P)}{\ell} &
      \infer[\foc]{T \mid \Gamma,\Delta,\Lambda \up Q}{
        \infer[\focR]{T \mid \Gamma,\Delta,\Lambda \dn Q}{
          \deduce{T \mid \Gamma,\Delta \dn \dbox{$X$}}{f}
          &
          \deduce{X \mid \Lambda \rf Q}{h}
        }
      }
    }
  }
}
& \circeq_\dn &
\proofbox{
  \infer[\focR]{\dbox{$P$} \mid \Delta,\Lambda \dn Q}{
    \infer[\unfoc]{\dbox{$P$} \mid \Delta \dn \dbox{$X$}}{
      \infer[\runL]{P \mid \Delta \up X}{
        \deduce{\L(T\mid\Gamma;P)}{\ell} &
        \infer[\foc]{T \mid \Gamma,\Delta \up X}{
          \infer[\focR]{T \mid \Gamma,\Delta \dn X}{
            \deduce{T \mid \Gamma,\Delta \dn \dbox{$X$}}{f}
            &
            \infer[\blurR]{X \mid ~ \rf X}{}
          }
        }
      }
    }
    &
    \deduce{X \mid \Lambda \rf Q}{h}
  }
}
\\[6pt]
\proofbox{
  \infer[\focL]{X \mid \Gamma \dn \dbox{$N$}}{
    \infer[\blurL]{X \mid ~ \lf X}{} &
    \infer[\unfoc]{\dbox{$X$} \mid \Gamma \dn \dbox{$N$}}{
      \deduce{X \mid \Gamma \up N}{f}
    }
  }
}
& \circeq_\dn &
\proofbox{
  \infer[\unfoc]{X \mid \Gamma \dn \dbox{$N$}}{
    \deduce{X \mid \Gamma \up N}{f}
  }
}
\\[6pt]
\proofbox{
  \infer[\focL]{\dbox{$P$} \mid \Gamma \dn X}{
    \infer[\unfoc]{\dbox{$P$} \mid \Gamma \dn \dbox{$X$}}{
      \deduce{P \mid \Gamma \up X}{f}
    }
    &
    \infer[\blurR]{X \mid ~ \rf X}{}
  }
}
& \circeq_\dn &
\proofbox{
  \infer[\unfoc]{\dbox{$P$} \mid \Gamma \dn X}{
    \deduce{P \mid \Gamma \up X}{f}
  }
}
\end{array}
\]
\end{landscape}
\end{document}
